# 计算机组成原理

# 第一章 计算机系统概述

## 基本概念

- *硬件*-hardware:物理装置的总称, 芯片, 板卡, 外设, 电缆等
- *软件*-software:运行在硬件上的程序和数据以及相关文档.
- *程序*-program:指挥计算机如何操作的一个指令序列, 也即程序由指令组成.
- *指令*-instruction:计算机硬件能够直接理解并执行的基本操作.
- *数据*-data: 指令操作的对象.  
- *中央处理器*, 处理器-Center Processing Unit, CPU: **是整个计算机的核心部件**, 主要用于指令执行. 主要包含两个基本部分
  - *数据通路*-datapath: 指令执行过程中数据所流经的部件, 其中包括各类运算部件. 
    - 算术逻辑部件-Arithmetic Logic Unit, ALU: 执行基本的算术和逻辑运算. 基本部件是加法器
      - 加法器: 所有算术运算都可以基于[加法运算和逻辑运算](https://blog.csdn.net/vlllllv/article/details/84675832)来实现
  - *控制器*-Controller: 对指令进行译码, 生成相应的控制信号, 以控制数据通路进行特定的操作. 
- *存储器*-Memory: 
- *外部设备*, 外设, I/O设备:I/O是Input/Output, 
  - I/O控制器或I/O适配器统称为设备控制器: 外设的控制逻辑
  - I/O接口/模块: 键盘接口, 打印机适配器, 显卡, 网卡
- *总线*-bus: 传输信息的通路
- *个人计算机*-PC: 用各种电缆将显示器, 键盘, 鼠标, 机箱等连接而成的一个装置
- 系统软件-system software: 为系统提供有效, 安全地使用和管理计算机以及为开发和运行应用软件而提供的各种软件, 介于计算机硬件与应用程序之间
  - 操作系统: Windows, Linux, UNIX
  - 语言处理系统: Visual Studio , GCC
  - 数据库管理系统: Oracle
- 应用软件-application software:

## 1, 计算机硬件的基本组成

冯·诺依曼结构: 

### 冯·诺依曼结构

冯·诺依曼体系结构即采用二进制逻辑、程序存储执行以及计算机由五个部分组成（运算器 + 控制器 (CPU)、存储器、输入设备、输出设备）的理论。

其特点为“程序存储，共享数据，顺序执行”，但数据与指令是共同存放在存储器结构中的.

**数字计算机的数制采用二进制；计算机应该按照程序顺序执行。**

冯·诺依曼理论的要点是：数字计算机的数制采用二进制；计算机应该按照程序顺序执行。人们把冯诺依曼的这个理论称为冯诺依曼体系结构。从ENIAC到当前最先进的计算机都采用的是冯诺依曼体系结构。所以冯诺依曼是当之无愧的数字计算机之父。

#### 基本思想

1, 采用存储程序的工作方式;

2, 计算机由*运算器*, *控制器*, *存储器*, *输入设备*和*输出设备*五个基本部件组成;

3, 

4,

> 通过输入设备输入程序和数据, 保存到存储器, 运行程序, 将程序中的指令运送到控制器进行译码, 根据指令的功能,送出相应的控制信号到运算器, 控制器控制运算器进行特定的运算, 运算结果再存储到存储器, 最好通过输出设备将存储器中的运算结果输出.

### 哈佛结构

**哈佛结构是一种将程序指令存储和数据存储分开的存储器结构。**

哈佛结构是一种将程序指令存储和[数据存储](https://baike.baidu.com/item/数据存储/9827490)分开的[存储器结构](https://baike.baidu.com/item/存储器结构/15630130)。哈佛结构是一种并行[体系结构](https://baike.baidu.com/item/体系结构)，它的主要特点是将程序和数据存储在不同的存储空间中，即[程序存储器](https://baike.baidu.com/item/程序存储器/7661398)和数据存储器是两个独立的存储器，每个存储器[独立编址](https://baike.baidu.com/item/独立编址/10391400)、独立访问。

哈佛结构的计算机分为三大部件：（1）CPU；（2）程序存储器；（3）数据存储器。

它的特点是将程序指令和数据分开存储，由于数据存储器与程序存储器采用不同的总线，因而较大的提高了存储器的带宽，使之数字信号处理性能更加优越。

### 二者区别和联系

冯.诺依曼指出：程序只是一种（特殊）的数据，它可以像数据一样被处理，因此可以和数据一起被存储在同一个存储器中——这就是著名的冯.诺依曼原理。注意:数据总线和地址总线共用。

哈佛结构: 哈佛结构是一种并行体系结构，它的主要特点是将程序和数据存储在不同的存储空间中，即程序存储器和数据存储器是两个独立的存储器，每个存储器独立编址、独立访问。与两个存储器相对应的是系统的4条总线：程序的数据总线与地址总线，数据的数据总线与地址总线。这种分离的程序总线和数据总线允许在一个机器周期内同时获得指令字（来自程序存储器）和操作数（来自数据存储器），从而提高了执行速度，使数据的吞吐率提高了1倍。又由于程序和数据存储器在两个分开的物理空间中，因此取指和执行能完全重叠。CPU首先到程序指令存储器中读取程序指令内容，解码后得到数据地址，再到相应的数据存储器中读取数据，并进行下一步的操作（通常是执行）。

哈佛结构与[冯·诺依曼结构](https://baike.baidu.com/item/冯·诺依曼结构)处理器相比，处理器有两个明显的特点：使用两个独立的[存储器](https://baike.baidu.com/item/存储器)模块，分别存储指令和数据，每个存储模块都不允许指令和数据并存；使用独立的两条总线，分别作为CPU与每个存储器之间的专用通信路径，而这两条总线之间毫无关联。

改进的哈佛结构，其结构特点为：

使用两个独立的存储器模块，分别存储指令和数据，每个存储模块都不允许指令和数据并存，以便实现[并行处理](https://baike.baidu.com/item/并行处理)；具有一条独立的[地址总线](https://baike.baidu.com/item/地址总线)和一条独立的[数据总线](https://baike.baidu.com/item/数据总线)，利用公用地址总线访问两个存储模块（程序存储模块和[数据存储](https://baike.baidu.com/item/数据存储)模块），公用数据总线则被用来完成程序存储模块或数据存储模块与CPU之间的数据传输；两条总线由[程序存储器](https://baike.baidu.com/item/程序存储器)和数据存储器分时共用。

## 2, 计算机软件概述

计算机的工作由存储在其内部的程序控制, 这是冯诺依曼结构计算机的"存储程序"工作方式的重要特征, 因此程序或软件质量的好坏将大大影响计算机性能的发挥. 

## 3, 计算机系统的层次结构

\[应用(问题)]: 用户 >> [算法, 编程(语言), 操作系统/虚拟机]: 程序员 >> [指令集体系结构ISA, 微体系结构, 功能部件/RTL]: 架构师 >> [电路, 器件]: 电子工程师

对于任何一个应用(问题/需求), 最开始是用自然语言描述的, 但是计算机硬件只能理解机器语言, 而要将衣蛾自然语言描述的应用问题转换为机器语言程序, 需要经过多个抽象层的转换. 

### 应用/问题/需求的实现步骤

- 首先, 应将应用问题转化为[*算法*, algorithm]描述, 使得应用问题的求解变成流程化的清晰步骤, 并能确保步骤是有限的. 任何一个问题可能有多个求解算法, 需要进行算法分析以确定那种算法在时间和空间上能够得到优化. 
- 其次, 将算法转换为用编程语言描述的[*程序*, program], 该步骤通常由程序员完成, 根据算法来编写程序.
- 最后, 需要将高级语言程序转换成计算机能够理解的机器语言程序

### 编程语言

编程语言-programing language: 与自然语言不同, 它有严格的执行顺序, 不存在二义性, 能够唯一地确定计算机执行指令的顺序

汇编语言和机器语言都是机器级语言

## 程序开发与执行过程

```c
#include <stdio.h>

int main() {
    printf("hello, world\n")
}
```



通过程序编程软件得到`hello.c`文件(源程序, 文本文件, 可显示可读). 

将hello.c进行预处理、编译、汇编和链接, 最终生成可执行目标文件

![Lightbox](https://wwfyde.oss-cn-hangzhou.aliyuncs.com/images/20210426194812.png)

![Compiler assembler linker and loader](https://wwfyde.oss-cn-hangzhou.aliyuncs.com/images/20210426194816.png)

![v2-c8d5b0a6e16ef75f7bdff5b5ae13e3c6_r](https://wwfyde.oss-cn-hangzhou.aliyuncs.com/images/20210426194821.jpg)

# 第二章 数据的表示和运算

# 第三章 指令系统

# 第四章 中央处理器

## 专业术语

- **中央处理器**(Central Process Unit, CPU): 
    - 数据通路和控制器是CPU的基本部件
    - 程序启动后, 计算机能自动逐条取出程序中的指令并执行
    - 数据通路在控制器产生的控制信号控制下完成特定的指令功能
- **程序计数器**(Program Counter，PC)：是一个中央处理器中的寄存器，用于指示计算机在其程序序列中的位置。接着要运行的指令地址。
    - 也称指令指针（instruction pointer，IP），有时又称为指令地址寄存器（instruction address register，IAR）、指令计数器或只是指令序列器的一部分。
    - 处理器通常从存储器中顺序获取指令，但控制转移指令(control transfer instruction)通过在PC中添加一个新值来改变顺序。这包括分支(跳转), 子程序调用和返回. 这让程序可以不同条件下执行不同的顺序.
    - 转移类指令: 无条件转移指令、条件转移指令、调用指令和返回指令等.
    - PC在递增后获取一个指令(instruction), 并保存下一条将要执行的指令的内存地址。
    - 跳转从内存中的其他地方获取指令,
    - 子程序调用跳转并保存之前的PC指令内容到别处
    - 返回检索PC保存的内容并放回PC, 用子程序调用之后恢复顺序执行. 
    - 硬件实现: 指令周期(instruction cycle)从一个取值开始，在这个取值过程中，CPU把PC的值放在地址总线上，把它发送到内存中。
- 指令周期: CPU取出并执行一条指令的时间, 不同指令的指令周期可能不同.
- 指令(instruction)
    - 指令结构: 序列 - 存储地址 - 机器码 - 汇编表示
    - 每条指令的长度都是4个字节(不同指令集可能不同), 32位的序列, 指令存放在内存空间

## 程序及指令的执行过程

### CPU执行指令过程

- 取指令. 
- 对指令译码
- 计算源操作数地址并取操作数
- 数据操作
- 目的操作数地址计算并存结果
- 指令地址计算并将其送PC

![指令执行过程](https://wwfyde.oss-cn-hangzhou.aliyuncs.com/images/20210426194827.png)

### CPU的基本功能和基本组成

## 其他笔记

## CPU架构

CPU 的根本任务就是执行指令，对计算机来说最终都是一串由 0 和 1 组成的序列。CPU 从逻辑上可以划分成 3 个模块，分别是控制单元、运算单元和存储单元 。其内部架构如下：

![img](https://wwfyde.oss-cn-hangzhou.aliyuncs.com/images/20210426194831.png)

#### 【1】控制单元

控制单元是整个CPU的指挥控制中心，由指令寄存器*IR*（Instruction Register）、指令译码器*ID*（Instruction Decoder）和 操作控制器*OC*（Operation Controller） 等组成，对协调整个电脑有序工作极为重要。它根据用户预先编好的程序，依次从存储器中取出各条指令，放在指令寄存器IR中，通过指令译码（分析）确定应该进行什么操作，然后通过操作控制器OC，按确定的时序，向相应的部件发出微操作控制信号。操作控制器OC中主要包括：节拍脉冲发生器、控制矩阵、时钟脉冲发生器、复位电路和启停电路等控制逻辑。

#### 【2】运算单元

运算单元是运算器的核心。可以执行算术运算（包括加减乘数等基本运算及其附加运算）和逻辑运算（包括移位、逻辑测试或两个值比较）。相对控制单元而言，运算器接受控制单元的命令而进行动作，即运算单元所进行的全部操作都是由控制单元发出的控制信号来指挥的，所以它是执行部件。

#### 【3】存储单元

存储单元包括 CPU 片内缓存和寄存器组，是 CPU 中暂时存放数据的地方，里面保存着那些等待处理的数据，或已经处理过的数据，CPU 访问寄存器所用的时间要比访问内存的时间短。采用寄存器，可以减少 CPU 访问内存的次数，从而提高了 CPU 的工作速度。寄存器组可分为专用寄存器和通用寄存器。专用寄存器的作用是固定的，分别寄存相应的数据；而通用寄存器用途广泛并可由程序员规定其用途。

### 工作原理

总的来说，CPU 从内存中一条一条地取出指令和相应的数据，按指令操作码的规定，对数据进行运算处理，直到程序执行完毕为止。具体过程可分为以下四步：

#### **【1】取指令**

CPU 控制器从内存读取一条指令并放入指令寄存器。指令的格式如下：

 ![img](https://wwfyde.oss-cn-hangzhou.aliyuncs.com/images/20210426194840.png)

> **操作码**：就是汇编语言里的 mov，add，jmp 等符号码；
>
> **操作数地址**：说明该指令需要的操作数所在的地方，是在内存里还是在CPU的内部寄存器里。

#### **【2】指令译码**

指令寄存器中的指令经过译码，决定该指令应进行何种操作（就是指令里的操作码）、操作数在哪里（操作数的地址） 。

#### **【3】 执行指令**

执行指令分为两个阶段： 取操作数 和 进行运算 。

> **取操作数**：CPU 通过寻址操作，从内存（数据段）中读取操作数到通用寄存器中，暂存起来。
>
> **进行运算**：运算单元通过指令中的操作码，对寄存器中的操作数进行 mov，add，jmp 操作。

#### **【4】 指令计数**

修改指令计数器，决定下一条指令的地址 。CPU 重复上述三步操作，处于内存代码段的指令被逐个的执行，直到程序执行完毕为止。

### CPU 字长

CPU在单位时间内(同一时间)能一次处理的二进制数的位数叫字长。所以，能处理字长为 8 位数据的 CPU 通常就叫 8 位的 CPU。同理，32 位CPU 能在单位时间内处理字长为 32 位的二进制数据 。

常见的 32位 CPU 和 64位 CPU 主要存在以下两个差异：

#### **【1】处理能力不同**

32 位 CPU 的一个指令，最大能处理 32 位二进制数据，即一次能处理 4 个字节数据。
64 位 CPU 的一个指令，最大能处理 64 位二进制数据，即一次能处理 8 个字节数据。

#### **【2】寻址空间不同**

32 位 CPU 的寻址范围是 32 位的二进制，32位二进制能表示的地址长度为2的32次方，即寻址空间最大为 4GB。
而 64 位CPU的寻址范围是 64 位的二进制。能表示的地址长度更大，其寻址空间也会更大。

# 第五章 存储器层次结构

# 第六章 互连及输入输出组织