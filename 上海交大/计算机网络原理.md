# 计算机网络原理

## 学习技巧/策略

- 清晰和明确课程目标多多查看课程目标页
- 学习规划: 共8章, 现在有共4本书, 还有3个月 差不多12周, 三周搞定一本书, 
- **两天看完一章** **还要考虑复习和练习题的时间**
- 复习时重点: **看笔记**, **章总节**, **做习题** 
- 根据<u>学习目标</u>, 章总结, 习题来, 来确定自己的学习情况
- **以通过为核心目标**
- 通过白描扫描纸质书

# 第一章 计算机网络概述

## 学习技巧

多看大纲, 章小节, 刷题, 综合理解, 融会贯通

## 基本概念

- 语法 syntax - 格式/结构,  语义: semantics - 数据/控制信息*(配置)*
- <u>链路: 无源的点对点物理连接.</u> 有线通信时，链路指两个节点之间的物理线路，如电缆或光纤。无线电通信时，链路指基站和终端之间传播电磁波的路径空间。水声通信时链路指换能器和水听器之间的传播声波的路径空间。
- 服务提供商(Internet Service Provider,ISP)
- 协议(Protocol)
- 开发系统互联(Open System Interconnection, OSI)
- 中继/relay: 中继（Relay）是两个交换中心之间的一条**传输通路**。中继线是承载多条逻辑链路的一条物理连接。随着科技发展，中继的概念不仅应用于无线通信中，[网络通信](https://baike.baidu.com/item/网络通信/9636548)交换机的trunk也可以称之为一种中继。在日常生活中，我们经常需要通过家里的电话和朋友聊天，或者通过办公室的电话和公司外的客户联系。要实现这些通话都离不开中继。Relay是移动网络专业术语，（中继，Relay Node）是指基站或用户不直接将信号发送给彼此，而是通过中继节点，经过信号放大或再生处理进行转发。
- 电平:level = lg(V~2~/V~1~)，是指两[功率](https://baike.baidu.com/item/功率/808705)或[电压](https://baike.baidu.com/item/电压/269108)之比的[对数](https://baike.baidu.com/item/对数/91326)，有时也可用来表示两电流之比的对数。电平的单位分贝用dB表示。常用的电平有功率电平和电压电平两类，它们各自又可分为绝对电平和相对电平两种。
- 信道:[[维基](https://zh.wikipedia.org/wiki/%E4%BF%A1%E9%81%93)], 通信信道: **信道**又被称为**通道**、**频道**和**波道**，是[信号](https://zh.wikipedia.org/wiki/信号)在[通信系统](https://zh.wikipedia.org/w/index.php?title=通信系统&action=edit&redlink=1)中传输的通道，由信号从发射端传输到接收端所经过的[传输媒质](https://zh.wikipedia.org/wiki/介质)所构成。广义的信道定义除了包括传输媒质，还包括传输信号的相关设备。狭义信道，按照传输媒质来划分，可以分为 **有线信道**、**无线信道** 和 **存储信道** 三类。
- 以太网
- 数据交换
- 路由-[[维基](https://zh.wikipedia.org/wiki/%E8%B7%AF%E7%94%B1)]routing: 就是通过互联的[网络](https://zh.wikipedia.org/wiki/互聯網)把[信息](https://zh.wikipedia.org/wiki/信息)从源地址传输到目的地址的活动。路由与[桥接](https://zh.wikipedia.org/wiki/桥接)的不同，在于路由假设地址相似的节点距离相近。这使得路由表中的一项纪录可以表示到一群地址的路径。路由已经成为[互联网](https://zh.wikipedia.org/wiki/網際網路)上查找路径的最主要方法。路由形式:单播,任波, 多播, 广播
- 用户代理(user-agent): 通常是指用户访问服务所用的应用 比如浏览器, APP



## 一 计算机网络的基本概念

### 1.计算机网络定义

> 解决的需求是 计算机之间快速大量的进行交换或分享信息, 于是人民便将计算机技术与通信技术进行完美结合, 诞生了计算机网络. 从技术范畴来看, 计算机网络是计算机技术与通信技术相互融合的产物

**定义**: 计算机网络是利用通信设备与通信链路或者通信网络, 互连位置不同, 功能自治的计算机系统, 并遵循一定的规则实现计算机系统之间信息交换. 

**概括性定义**: 计算机网络是互连的, 自治的计算机集合. 

**分组交换设备**可以实现数据分组的接收与转发, 是构成Internet的重要基础, 存在多种形式, 最典型的是路由器和交换机. Internet中互连的端系统, 分组交换设备或其他网络设备在进行信息发送, 接收或转发的过程中, 都需要遵循一些规则或约定, 即网络协议. 



### 2.协议的定义

计算机网络中的实体在进行数据交换的过程中也必须遵循一些规则或约定, 这些规则或约定就是网络协议. 

协议是网络通信实体之间在数据数据交换过程中需要遵循的规则或约定, 是计算机网络有序运行的重要保证. 

网络中的**通信实体**是"<u>机器</u>"或"<u>软件程序</u>"

事实上, 计算机网络中的所有通讯过程都会遵循某个或某些协议, 或者说计算机网络中的所有通信过程都是有么个或某些协议所控制. 计算机网络中存在很多协议, **学习计算机网络的重要内容之一就是要学习一些典型的网络协议**

**协议约定了实体之间交换的信息类型,信息各部分的含义, 信息交换顺序以及收到特定信息或出现异常时应采取的行为**

任何一个协议都会显式或隐式地定义3个基本要素: 语法:syntax, 语义:semantics, 时序:timing; 简称协议三要素. 

#### A.语法

语法定义实体之间交换信息的**格式与结构**, 或者定义实体之间传输信号的电平*(:两个点的电压之比的以10为底数的对数)*等.

#### B.语义

语义定义实体键交换的信息中需要发送或包含哪些**控制信息**, 这些信息的具体**含义**, 以及针对不同含义的控制信息,接收信息端**如何响应**. 另外有的协议还需要进行**差错检测**, 这类协议通常会在协议信息中附加差错编码等控制信息. 语义还需要定义彼此采用何种差错编码, 以及采取何种**差错处理机制**等. 

#### C. 时序

时序*:同步*定义实体之间交换信息的**顺序**以及如何匹配或适应彼此的**速度**



### 3.计算机网络的功能

**计算机网络的功能是在不同主机之间实现快速信息交换.** 通过信息交换, 计算机网络可实现<u>资源共享</u>这一核心功能, 包括硬件资源共享, 软件资源共享和信息资源共享. 

#### A.硬件资源共享

通过计算机网络, 一台主机可以共享使用另一台主机的硬件资源 *:计算资源(CPU), 存储资源, 打印机, 扫描仪I/O设备等.* 

**事实上, 云计算和云存储可以提供硬件计算资源和储存资源的共享, 这都是典型的硬件共享的实例**

#### B.软件资源共享

网络上的主机可以远程访问和使用服务器计算机上运行的各类大型软件

软件及服务*(Software as a SaaS)* 是目前互联网环境下软件共享的典型形式, 也代表了软件共享的主流趋势. 

优势: 避免软件重复投资和重复部署, 有效节省成本.

#### C.信息资源共享

信息的载体是网络, 人们通过网络发布和分享信息.

计算机网络所支持的信息交换就是典型的信息资源共享

### 4.计算机网络的分类

#### 按覆盖范围

**个域网**(:Personal Area Network, PAN)

个域网是近几年随着穿戴设备, 便携式移动设备的快速发展而提出的网络类型. 通常是由个人设备通过无线通信技术构成的小范围网络, 实现个人设备间的数据传输, 比如通过蓝牙技术实现个人设备的互连等. 

场景: 个人设备, 穿戴设备, 便携式设备

覆盖范围通常在:1-10m

**局域网**(:Local Area Network, LAN)

采用高速有线或无线链路连接主机, 实现局部范围内高速数据传输. 

覆盖范围通常在: 10m~1km

应用场景:办公室, 办公楼, 厂区, 校园等

**城域网**(:Metropolitan Area Network, MAN)

覆盖一个城市范围的网络

覆盖范围通常在5~50km

**广域网**(:Wide Area Network, WAN)

广域网跨越更大的地理空间, 可以实现异地城域网或局域网的互连

覆盖范围在几十到几千千米

#### 按拓扑结构

网络拓扑是指网络的主机, 网络设备间的物理连接关系与布局. 

**这些线条是链路,可以是无线通信链路**

- **星形拓扑结构**
  - 包括一个**中央节点**, 网络中的主机通过点对点通信链路与中央节点连接
  - 中央节点通常是集线器, 交换机等设备, 主机之间通信都要通过中央节点进行. 多见于局域网,个域网
  - **优点**: 易于监控与管理, 故障诊断与隔离容易
  - **缺点**: 中央节点是网络的瓶颈, 一旦故障, 全网瘫痪, 网络规模受限于中央节点的端口数量. 
- 总线拓扑结构
  - 一条广播信道作为公共传输介质, 称为总线, 所有节点均与总线连接, 节点间的通信均通过共享的总线进行
  - 由于总线是一条广播信道, 所以任一节点通过总线发送数据时, 其他节点都会接收到承载这些数据的信号. 如果同时有两个或两个以上的节点同时向共享信道中发送数据, 就会产生干扰, 会导致任何一个节点的数据发送失败, 这一现象称为冲突. 
  - 场景: 早期的局域网中比较多见
  - 优点: 结构简单,所需电缆数量少, 易于扩展
  - 缺点: 通信范围受限, 故障诊断与隔离较困难, 容易产生冲突
- 环形拓扑结构
  - 利用通信链路将所有节点连接成一个闭合的环
  - 环中的数据传输通常是单向(也可以双向)传输, 每个节点可以从环中接收数据, 并向环中进一步转发数据
  - 优点: 所需电缆长度端, 可以使用光纤, 易于避免冲突
  - 缺点: 节点的故障容易引起全网瘫痪, 新节点的加入或撤出过程比较麻烦,存一条链路在等待时间的问题
- **网状拓扑结构**
  - 通过多条链路与不同节点直接连接
  - 场景: 广域网, 核心网络
  - 优点: 网络可靠性高, 一条或多条链路故障时, 网络任然可联通;
  - 缺点: 网络结构复杂, 造价成本高, **选路协议**复杂. 
- **树形拓扑结构**
  - 可以看作是总线型拓扑或星形拓扑网络的扩展. 比较多见的是通过级联星形拓扑结构网络中的中央节点构建树形拓扑结构网络
  - 场景:很多局域网采用这种拓扑结构
  - 优点:易于扩展, 故障隔离容易
  - 缺点: 对根节点可靠性要求高, 一旦根节点故障, 则可能导致网络大范围无法通信
- 混合拓扑结构
  - 两种以上简单拓扑结构网络混合连接而成的网络
  - 绝大多数实际网络的拓扑都属于混合拓扑结构, 比如Internet
  - 优点: 易于扩展, 可以构建不同规模网络, 并可根据需要优选网络结构
  - 缺点: 网络结构复杂, 管理与维护复杂. 

### 按交换方式

数据交换是指网络通过彼此互连的节点间的数据转接, 实现将数据从发送节点送达目的节点的过程和技术. 

电路交换网络, 报文交换网络, 分组交换网络

### 按网络用户属性

按网络用户属性, 计算机网络可以分为公用网和专用网

#### 公用网(public network)

国家或企业出资建设, 面向公众提供收费或免费服务的网络. 

特点: 面向公众开放的, 用户只要按规定缴纳费用都可以接入网络, 使用网络设施与服务. 

#### 私有网/专用网(private network)

## 二 计算机网络结构

计算机网络规模不同, 其结构复杂程度也有所不同. 大规模现代计算机网络的结构包括 **网络边缘**(network edge), **接入网络**(access network) 与 **网络核心**(network core) 三个部分. 

### 1.网络边缘

网络边缘: 网络应用主机或端系统. 比如:计算机, 服务器, 只能手机, 智能传感器, 智能家电等.

网络边缘上的端系统运行分布式网络应用, 在端系统之间进行数据交换, 实现应用目的.

**网络边缘为网络用户提供网络应用服务**

### 2.接入网络

接入网络技术和方式

#### 电话拨号接入

非对称数字用户线路ADSL

#### **混合光纤同轴电缆HFC接入网络**

#### 局域网

#### **移动接入网络**

### 3.网络核心

网络核心是由通信链路互连的分组交换设备构成的网络

网络核心通过数据交换实现数据的中继与转发. 

## 三 数据交换技术

数据交换概念

<u>计算机网络的根本目的是在网络边缘的主机之间实现相互的数据传输和信息交换.</u> 

交换设备: 多通信端口, 可以同时连接多个通信节点(主机或交换设备), 实现通信端口间物理或逻辑上的动态, 并行通信. 通过交换设备, 每个主机只需一个通信链路与交换设备相连, 即可实现与其他主机通信

**数据交换网络**: 不需要关心所传输数据的内容, 只是为这些数据从一个节点到另一个节点直至到达目的节点提供中继与交换功能.

**交换节点**: 交换设备的

**通信子网**: 交换节点和传输介质的集合 即为 **网络核心**.

数据交换是实现在大规模网络核心上进行数据传输的技术基础. 

常见的数据交换技术包括电路交换(circuit switching), 报文交换(message switching), 分组交换(packet switching).

### 电路交换

### 报文交换

交换节点



### **分组交换**

>  分组 > packet 将要传输的数据格式化, 固定大小

#### 1, 分组交换基本原理

分组交换需要将待传输数据(报文)分割成较小的数据块, 每个数据块附加上地址, 序号等控制信息构成数据分组(packet), 每个分组独立传输到目的地, 目的地将收到的分组重新组装, 还原成报文. **分组传输过程通常也采用存储--转发交换方式**

分组交换是报文交换的一种改进, 它将一个完整报文拆分成若干个分组, 么个分组的长度有一个上线, 有限长度的分组使得每个节点所需的存储能力降低, **分组可以存储到内存, 提高了交换速度**.

分组交换是计算机网络使用最广泛的一种数据交换技术, 现代计算机网络几乎都是分组交换网络. 

#### 2, 分组交换的优点

与报文交换相比, 两者都采用 <u>存储-转发</u> 交换方式, 最主要的区别在于是否将报文拆分为更小的分组. 

分组交换在拆分与组装过程中, 一方面会消耗一定的计算资源, 另一方面还需要附加更多的控制信息, 会在一定程度上降低有效数据传输速率. 但这个做法却大大地改善了交换网络的性能

优点如下:

- 交换设备存储容量要求低
- 交换速度快
- 可靠传输效率高
  网络平均差错概率相同时, 文件越大, 差错概率越大,
- 更加公平

####  3, 分组长度的确定

##### 分组长度与延迟时间

分组交换网络的存储转发过程抽象为一个排队系统, 基于排队论的分析发现, 当分组具有相同的长度时, 分组在交换过程中的延迟较小. 因此将报文进行标准长度分割为"分组", 可以缩短信息在交换过程中的延迟时间. 分组长度越长, 延迟时间越长. 需要在 *延迟时间* 与 *性能开销* 之间进行平衡

实际的分组交换网络的分组长度并不总是相同的, 通常会规定一个分组长度范围, 这样既具有灵活性, 又尽可能优化网络延时. 

##### 分组长度与误码率

信道误码率是指整个分组长度中, 信道出现错误的概率



**最佳分组长度**: 16B - 4096B

## 四 计算机网络性能



### 速率与带宽 - rate and bandwith

### 时延:延迟 - delay

### 时延带宽积

### 丢包率

丢包现象: 网络拥塞特别严重时, 新到达的分组甚至已无缓存空间暂存该分组, 此时交换节点会丢弃分组, 就会发生"丢包"现象

### 吞吐量 - throughput



## 五 计算机网络体系结构

![preview](https://wwfyde.oss-cn-hangzhou.aliyuncs.com/images/20210426192353.jpg)

### 1 计算网络分层体系结构

分层的核心思路是上一层的功能建立在下一层的功能基础上, 并且在每一层内均需要遵守一定的通信规则, 即协议.

典型的层次化体系结构有 <u>OSI参考模型</u> 和 <u>TCP/IP参考模型</u> 两种

### 2 **OSI参考模型**

![image-20210320165159104](https://wwfyde.oss-cn-hangzhou.aliyuncs.com/images/20210426192358.png)



本质是 对信号的传输和处理和控制

开发系统互联(Open System Interconnection, OSI)

实通信: 物理层的两个端点进行物理通信.

虚拟通信: 对等层间的通信(应用层到应用层)

**节点到节点层**: 中间系统(如路由器)通常只实现物理层, 数据链路层和网络层功能.

**端到端层**: 传输层, 会话层, 表示层, 应用层

交换机路由器实际上是进行了对信号的中继和转转发

#### 1, 物理层

> 两大功能: 实现信号编码 和 规定设备接口相关特性
>
> 物理层: 强调实体, 处理单元是: 电磁波, 信号

功能和作用: 在传输介质上实现无结构比特流传输, **物理层要实现信号编码功能**.

模型理解: 载体是:铜线, 铁线, 光, 水等介质; 集线器, 接口定义了交换方式

**无结构比特流**: 不关心比特流世界代表信息内容, 只关心如何将0-1这些比特以合适的信号传送到目的地

物理层的另一项任务就是规定数据终端设备(DTE)与数据通信设备(DCE)之间接口的相关特性, 主要包括**机械**, **电气**,**功能** 和 **过程** 四个方面的特性. 

- 机械特性: 也叫物理特性,硬件连接接口的机械特点 说明: 接口形状,尺寸和插脚数量和排列方式;
- 电气特性: 导线的电气连接以及有关电路的特性;
- 功能特性: 各条信号线的用途, 如接口信号线的功能分类;
- 规程特性: 利用接口传输比特流的全过程及各项用于传输的事件发生的合法顺序, 包括事件的执行顺序和数据传输方式



#### 2, 数据链路层

> 有效传输, 流量控制,连接管理, 寻址
>
> [[维基](https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82)]
>
> 数据链路 : 强调 信道, 处理单元: 数据帧(DPF - data frame)

功能和作用: 实现在相邻节点之间数据可靠而有效的传输. **帧同步**, **差错控制**, **流量管理**, **链路管理**

模型理解: 载体是信道, 实现设备是交换机和桥接器

主要协议: 以太网, 点对点

理解: 隔离了物理层和网络层完成由比特到包的服务; 数据链路层只认识mac地址, 解决的是数据在一个network里面的传送 设备之间的通信方式是拉高拉低这根线的电平. 由于大家都在一条线上,每次通信所有设备都能听见,因此必须指明通信的目标(mac地址). 什么是mac地址,地址是怎么确定的,这就是数据链路层要解决的问题. 另外,这根线的材质, 具体是铜线还是铁线, 甚至是无线, 是物理层决定的.显然,光有物理层和链路层是不够的,因为我们不能指望所有设备都连在一条线上.因此,我们需要internet层. 这里inter-net这个单词可以顾名思义, net就是指的物理上连在一条线上的network, inter就是"之间"的意思. 这一层解决的就是这些networks之间的通信.

#### 3, 网络层

> 强调: 数据
>
> 处理的基本单位是: 分组(packet)



功能和作用: 数据**转发与路由**. 将分组通过交换网络传送至目的主机;对进入网络的通信量加以**控制**, 以避免通信量过大造成交换网络性能下降; **寻址**, 确保分组可以被正确传输到目的主机, 比如Internet网络中的IP地址. 

说明: 在交换网络中, 信息从源节点出发, 要经过若干个中继节点的存储转发后, 才能到达目的节点. 这样一个包括源节点, 中继节点, 目的节点的集合称为从源节点到目的节点的路径. 一般在两个节点之间都会有多条路径选择, 这种路由选择是网络层要完成的主要功能之一.

相关协议: IP

#### 4, 传输层

定义: 第一个端到端层次, 也是进程-进程的层次

功能和作用: 复用/分解(区分发送和接收主机上的进程), 端到端的可靠数据传输, 连接控制, 流量控制拥塞控制机制

说明: 数据的通信表面上看是在两台主机之间进行, 但实质上是发生在两个主机的进程之间. OSI参考模型的前三层(自下而上)可组成公共网络, 被很多设备共享, 并且计算机-交换节点(路由器,交换机等), 交换节点-交换节点是按照"接力"方式传送的. 为了防止传送途中报文的丢失, 两个主机的进程之间需要实现端对端控制. 

相关协议: TCP / UDP 

#### 5, 会话层

定义: 用户与用户的连接, 通过在两台计算机建立, 管理和终止通信来完成会话.

功能和作用: 身份核实是否有权参加会话, 确定双方支付通信费用, 双方在各种选择功能上是否取得一致, 会话建立后,需要对进程间的对话进行管理与控制: 对话数据保持, 终止对话. 

说明: 在实际的网络中, 会话层的功能已经被应用层所覆盖, 很少单独存在. 

#### 6, 表示层

功能和作用: 处理应用与实体间交换数据的语法, 目的是解决格式和数据表示的差别, 从而为应用层提供一个一致的数据格式, 使字符, 格式等有差异的设备之间相互通信; 除此之外, 表现层还可以实现文本压缩/解压缩, 数据加密/解密, 字符编码的转换等功能. 

说明: 这一层的功能在某些实际数据通信网络中是由应用层来实现的, 而且表示层不独立存在. 

#### 7, 应用层 

说明: 与提供用户的网络服务相关. 这些服务非常丰富, 包括文件传送, 电子邮件, P2P应用等.应用层为用户提供了一个使用网络应用的"接口". 

#### 总结

OSI参考模型的7层中, 1~3层主要是完成数据交换和数据传输, 称之为网络低层; 5~7层主要是完成信息处理服务的功能, 称之为网络高层; 低层与高层之间由第4层衔接. 

#### 相关术语

### 数据单元

- 协议数据单元(Protocol Data Unit, PDU)
- 服务数据单元(Service Data Unit, SDU)
- 协议控制信息(Protocol Control Information, PCI)

PDU在不同层往往有不同的叫法, 物理层称为**位流或比特流( bit stream)**, 在数据链路层称为 **帧(data frame)**, 在网络层称为 **分组或包(packet)**,在传输层称为 **数据端或报文段(data segment)**, 在应用层中称为 **报文(telegram)**. 

##### 服务访问点(Service Access Point, SAP)

##### 服务原语

第 `N` 层向 `N+1` 层提供服务, 或第 `N+1` 层请求 `N` 层提供服务 低层向高层提供(响应)服务, 高层向低层请求服务

- 请求(Request):
- 指示(Indication):
- 响应(Response):
- 证实(Confirm): 

##### 面向连接的服务和无连接的服务



### 3 **TCP/IP参考模型**

![tcpAndOSI](https://wwfyde.oss-cn-hangzhou.aliyuncs.com/images/20210426192411.png)

TCP/IP参考模型包括4层, 通常每一层封装的数据包采用不同的名称

#### 应用层 - Application Layer

每一个应用层协议一般都会使用到两个传输层协议之一进行数据传输: 面向连接的传输控制协议TCP 和 无连接的用户数据报协议UDP



#### 传输层 - Transport Layer

解决(如果需要)诸如端到端可靠性, 保证数据按照正确的顺序到达等问题

#### **网络互联层** - Internet Layer

网络互联层是整个 `TCP/IP` 参考模型的核心, 主要解决**把数据分组发往目的网络或主机**的问题. 在这个过程中, 要为分组的传输选择相应的路径(路由选择), 完成分组的转发, 提供网络层寻址——IP地址. 网络互联层处理需要完成**路由**的功能外, 也可以完成**将不同类型的网络(异构网)互联**的任务. 在TCP/IP参考模型中, 网络互联层的核心协议是IP, 负责定义分组的格式和传输. IP 是无连接不可靠网络协议, 因此, IP分组到达的顺序和发送的顺序可能不同, 并且可能存在分组丢失现象. 网络互联层还包括互联网控制报文协议ICMP, 互联网多播组管理协议IGMP以及路由协议, 如BGP, OSPF和RIP协议. 

#### 网络接口层 - Network Access Layer



### 4 **五层参考模型**

理解分层思想, 是分层执行, 不是分段执行, 网络层发送的单元`字节流-数据帧-分组` 	

物理层, 数据链路层, 网络层, 传输层, 应用层

比特流 -> 帧 -> 数据报 -> 段 -> 报文

bit stream -> data frame -> data packet -> data segment -> telegram

路由器/ 交换机 分别从对应的数据报/帧中取出相应的路由或地址信息进行处理, 并依据转发策略向正确的接口转发数据报/帧. **当数据到达目的主机后, 自下而上, 逐层处理并去掉相应的头部信息, 最终还原为最初的报文, 交付给用户.** 

路由器的处理单元是 分组数据(packet)

交换机 应用在 数据链路层, 处理单元是 帧(data frame)

在

### 5 拓展 - 交换机与路由器

计算机网络往往由许多种不同类型的网络互连连接而成。如果几个计算机网络只是在物理上连接在一起，它们之间并不能进行通信，那么这种“互连”并没有什么实际意义。因此通常在谈到“互连”时，就已经暗示这些相互连接的计算机是可以进行通信的，也就是说，从功能上和逻辑上看，这些计算机网络已经组成了一个大型的计算机网络，或称为互联网络，也可简称为互联网、互连网。

将网络互相连接起来要使用一些中间设备（或中间系统），ISO的术语称之为中继（relay）系统。根据中继系统所在的层次，可以有以下五种中继系统：

- 物理层（即常说的第一层、层L1）中继系统，即转发器（repeater）。
- 数据链路层（即第二层，层L2），即网桥或桥接器（bridge）。
- 网络层（第三层，层L3）中继系统，即路由器（router）。
- 网桥和路由器的混合物桥路器（brouter）兼有网桥和路由器的功能。
- 在网络层以上的中继系统，即网关（gateway）.



当中继系统是转发器时，一般不称之为网络互联，因为这仅仅是把一个网络扩大了，而这仍然是一个网络。高层网关由于比较复杂，目前使用得较少。因此一般讨论网络互连时都是指用交换机和路由器进行互联的网络。本文主要阐述交换机和路由器及其区别。

#### 2 交换机和路由器

“交换”是今天网络里出现频率最高的一个词，从桥接到路由到ATM直至电话系统，无论何种场合都可将其套用，搞不清到底什么才是真正的交换。其实交换一词最早出现于电话系统，特指实现两个不同电话机之间话音信号的交换，完成该工作的设备就是电话交换机。所以从本意上来讲，交换只是一种技术概念，即完成信号由设备入口到出口的转发。因此，只要是和符合该定义的所有设备都可被称为交换设备。由此可见，“交换”是一个涵义广泛的词语，**当它被用来描述数据网络第二层的设备时，实际指的是一个桥接设备**；**而当它被用来描述数据网络第三层的设备时，又指的是一个路由设备。**

我们经常说到的**以太网交换机实际是一个基于网桥技术的多端口第二层网络设备**，它为数据帧从一个端口到另一个任意端口的转发提供了低时延、低开销的通路。

由此可见，交换机内部核心处应该有一个交换矩阵，为任意两端口间的通信提供通路，或是一个快速交换总线，以使由任意端口接收的数据帧从其他端口送出。在实际设备中，交换矩阵的功能往往由专门的芯片（ASIC）完成。另外，以太网交换机在设计思想上有一个重要的假设，即交换核心的速度非常之快，以致通常的大流量数据不会使其产生拥塞，换句话说，交换的能力相对于所传信息量而无穷大（与此相反，ATM交换机在设计上的思路是，认为交换的能力相对所传信息量而言有限）。

虽然以太网第二层交换机是基于多端口网桥发展而来，但毕竟交换有其更丰富的特性，使之不但是获得更多带宽的最好途径，而且还使网络更易管理。

而路由器是OSI协议模型的网络层中的分组交换设备（或网络层中继设备），路由器的基本功能是把数据（IP报文）传送到正确的网络，包括：

IP数据报的转发，包括数据报的寻径和传送；
子网隔离，抑制广播风暴；
维护路由表，并与其他路由器交换路由信息，这是IP报文转发的基础。
IP数据报的差错处理及简单的拥塞控制；
实现对IP数据报的过滤和记帐。

**路由器**---所谓路由就是指通过相互连接的网络把信息从源地点移动到目标地点的活动。一般来说，在路由过程中，信息至少会经过一个或多个中间节点。通常，人们会把路由和交换进行对比，这主要是因为在普通用户看来两者所实现的功能是完全一样的。其实，路由和交换之间的主要区别就是交换发生在OSI参考模型的第二层（数据链路层），而路由发生在第三层，即网络层。这一区别决定了路由和交换在移动信息的过程中需要使用不同的控制信息，所以两者实现各自功能的方式是不同的。

**交换机**---交换（switching）是按照通信两端传输信息的需要，用人工或设备自动完成的方法，把要传输的信息送到符合要求的相应路由上的技术统称。广义的交换机（switch）就是一种在通信系统中完成信息交换功能的设备。

在计算机网络系统中，交换概念的提出是对于共享工作模式的改进。我们以前介绍过的HUB集线器就是一种共享设备，HUB本身不能识别目的地址，当同一局域网内的A主机给B主机传输数据时，数据包在以HUB为架构的网络上是以广播方式传输的，由每一台终端通过验证数据包头的地址信息来确定是否接收。也就是说，在这种工作方式下，同一时刻网络上只能传输一组数据帧的通讯，如果发生碰撞还得重试。这种方式就是共享网络带宽。

交换机拥有一条很高带宽的背部总线和内部交换矩阵。交换机的所有的端口都挂接在这条背部总线上，控制电路收到数据包以后，处理端口会查找内存中的地址对照表以确定目的MAC（网卡的硬件地址）的NIC（网卡）挂接在哪个端口上，通过内部交换矩阵迅速将数据包传送到目的端口，目的MAC若不存在才广播到所有的端口，接收端口回应后交换机会“学习”新的地址，并把它添加入内部MAC地址表中。

使用交换机也可以把网络“分段”，通过对照MAC地址表，交换机只允许必要的网络流量通过交换机。通过交换机的过滤和转发，可以有效的隔离广播风暴，减少误包和错包的出现，避免共享冲突。

交换机在同一时刻可进行多个端口对之间的数据传输。每一端口都可视为独立的网段，连接在其上的网络设备独自享有全部的带宽，无须同其他设备竞争使用。当节点A向节点D发送数据时，节点B可同时向节点C发送数据，而且这两个传输都享有网络的全部带宽，都有着自己的虚拟连接。假使这里使用的是10Mbps的以太网交换机，那么该交换机这时的总流通量就等于2×10Mbps＝20Mbps，而使用10Mbps的共享式HUB时，一个HUB的总流通量也不会超出10Mbps。

总之，交换机是一种基于MAC地址识别，能完成封装转发数据包功能的网络设备。交换机可以“学习”MAC地址，并把其存放在内部地址表中，通过在数据帧的始发者和目标接收者之间建立临时的交换路径，使数据帧直接由源地址到达目的地址

 

 

说明二层交换机、三层交换机和路由器的基本工作原理和三者之间的主要区别。

解答：1.二层交换技术

二层交换机是数据链路层的设备，它能够读取数据包中的MAC地址信息并根据MAC地址来进行交换。

交换机内部有一个地址表，这个地址表标明了MAC地址和交换机端口的对应关系。当交换机从某个端口收到一个数据包，它首先读取包头中的源MAC地址，这样它就知道源MAC地址的机器是连在哪个端口上的，它再去读取包头中的目的MAC地址，并在地址表中查找相应的端口，如果表中有与这目的MAC地址对应的端口，则把数据包直接复制到这端口上，如果在表中找不到相应的端口则把数据包广播到所有端口上，当目的机器对源机器回应时，交换机又可以学习一目的MAC地址与哪个端口对应，在下次传送数据时就不再需要对所有端口进行广播了。

二层交换机就是这样建立和维护它自己的地址表。由于二层交换机一般具有很宽的交换总线带宽，所以可以同时为很多端口进行数据交换。如果二层交换机有N个端口，每个端口的带宽是M，而它的交换机总线带宽超过N×M，那么这交换机就可以实现线速交换。二层交换机对广播包是不做限制的，把广播包复制到所有端口上。

二层交换机一般都含有专门用于处理数据包转发的ASIC （Application specific Integrated Circuit）芯片，因此转发速度可以做到非常快。

#### 路由技术

路由器是在OSI七层网络模型中的第三层——网络层操作的。

路由器内部有一个路由表，这表标明了如果要去某个地方，下一步应该往哪走。路由器从某个端口收到一个数据包，它首先把链路层的包头去掉（拆包），读取目的IP地址，然后查找路由表，若能确定下一步往哪送，则再加上链路层的包头（打包），把该数据包转发出去；如果不能确定下一步的地址，则向源地址返回一个信息，并把这个数据包丢掉。

路由技术和二层交换看起来有点相似，其实路由和交换之间的主要区别就是交换发生在OSI参考模型的第二层（数据链路层），而路由发生在第三层。这一区别决定了路由和交换在传送数据的过程中需要使用不同的控制信息，所以两者实现各自功能的方式是不同的。

路由技术其实是由两项最基本的活动组成，即决定最优路径和传输数据包。其中，数据包的传输相对较为简单和直接，而路由的确定则更加复杂一些。路由算法在路由表中写入各种不同的信息，路由器会根据数据包所要到达的目的地选择最佳路径把数据包发送到可以到达该目的地的下一台路由器处。当下一台路由器接收到该数据包时，也会查看其目标地址，并使用合适的路径继续传送给后面的路由器。依次类推，直到数据包到达最终目的地。

路由器之间可以进行相互通讯，而且可以通过传送不同类型的信息维护各自的路由表。路由更新信息主是这样一种信息，一般是由部分或全部路由表组成。通过分析其它路由器发出的路由更新信息，路由器可以掌握整个网络的拓扑结构。链路状态广播是另外一种在路由器之间传递的信息，它可以把信息发送方的链路状态及进的通知给其它路由器。

#### 三层交换技术

一个具有第三层交换功能的设备是一个带有第三层路由功能的第二层交换机，但它是二者的有机结合，并不是简单的把路由器设备的硬件及软件简单地叠加在局域网交换机上。

从硬件上看，第二层交换机的接口模块都是通过高速背板/总线（速率可高达几十Gbit/s）交换数据的，在第三层交换机中，与路由器有关的第三层路由硬件模块也插接在高速背板/总线上，这种方式使得路由模块可以与需要路由的其他模块间高速的交换数据，从而突破了传统的外接路由器接口速率的限制。在软件方面，第三层交换机也有重大的举措，它将传统的基于软件的路由器软件进行了界定。

其做法是：

对于数据包的转发：如IP/IPX包的转发，这些规律的过程通过硬件得以高速实现。

对于第三层路由软件：如路由信息的更新、路由表维护、路由计算、路由的确定等功能，用优化、高效的软件实现。

假设两个使用IP协议的机器通过第三层交换机进行通信的过程，机器A在开始发送时，已知目的IP地址，但尚不知道在局域网上发送所需要的MAC地址。要采用地址解析（ARP）来确定目的MAC地址。机器A把自己的IP地址与目的IP地址比较，从其软件中配置的子网掩码提取出网络地址来确定目的机器是否与自己在同一子网内。若目的机器B与机器A在同一子网内，A广播一个ARP请求，B返回其MAC地址，A得到目的机器B的MAC地址后将这一地址缓存起来，并用此MAC地址封包转发数据，第二层交换模块查找MAC地址表确定将数据包发向目的端口。若两个机器不在同一子网内，如发送机器A要与目的机器C通信，发送机器A要向“缺省网关”发出ARP包，而“缺省网关”的IP地址已经在系统软件中设置。这个IP地址实际上对应第三层交换机的第三层交换模块。所以当发送机器A对“缺省网关”的IP地址广播出一个ARP请求时，若第三层交换模块在以往的通信过程中已得到目的机器C的MAC地址，则向发送机器A回复C的MAC地址；否则第三层交换模块根据路由信息向目的机器广播一个ARP请求，目的机器C得到此ARP请示后向第三层交换模块回复其MAC地址，第三层交换模块保存此地址并回复给发送机器A。以后，当再进行A与C之间数据包转发进，将用最终的目的机器的MAC地址封装，数据转发过程全部交给第二层交换处理，信息得以高速交换。既所谓的一次选路，多次交换。

第三层交换具有以下突出特点：

有机的硬件结合使得数据交换加速；

优化的路由软件使 得路由过程效率提高；

除了必要的路由决定过程外，大部分数据转发过程由第二层交换处理；

多个子网互连时只是与第三层交换模块的逻辑连接，不象传统的外接路由器那样需增加端口，保护了用户的投资。

#### 交换机的定义

　　局域网交换机拥有许多端口，每个端口有自己的专用带宽，并且可以连接不同的网段。交换机各个端口之间的通信是同时的、并行的，这就大大提高了信息吞吐量。为了进一步提高性能，每个端口还可以只连接一个设备。

　　为了实现交换机之间的互连或与高档服务器的连接，局域网交换机一般拥有一个或几个高速端口，如100MB以太网端口、FDDI端口或155MB ATM端口，从而保证整个网络的传输性能。

#### 交换机的特性

　　通过集线器共享局域网的用户不仅是共享带宽，而且是竞争带宽。可能由于个别用户需要更多的带宽而导致其他用户的可用带宽相对减少，甚至被迫等待，因而也就耽误了通信和信息处理。利用交换机的网络微分段技术，可以将一个大型的共享式局域网的用户分成许多独立的网段，减少竞争带宽的用户数量，增加每个用户的可用带宽，从而缓解共享网络的拥挤状况。由于交换机可以将信息迅速而直接地送到目的地能大大提高速度和带宽，能 保护用户以前在介质方面的投资，并提供良好的可扩展性，因此交换机不但是网桥的理想替代物，而且是集线器的理想替代物。

　　与网桥和集线器相比，交换机从下面几方面改进了性能：

　　（1）通过支持并行通信，提高了交换机的信息吞吐量。

　　（2）将传统的一个大局域网上的用户分成若干工作组，每个端口连接一台设备 或连接一个工作组，有效地解决拥挤现像。这种方法人们称之为网络微分 段（Micro一segmentation）技术。

　　（3）虚拟网（VirtuaI LAN）技术的出现，给交换机的使用和管理带来了更大 的灵活性。我们将在后面专门介绍虚拟网。

　　（4）端口密度可以与集线器相媲美,一般的网络系统都是有一个或几个服务器，而绝大部分都是普通的客户机。客户机都需要访问服务器，这样就导致服务器的通信和事务处理能力成为整个网络性能好坏的关键。

　　交换机就主要从提高连接服务器的端口的速率以及相应的帧缓冲区的大小，来提高整个网络的性能，从而满足用户的要求。一些高档的交换机还采用全双工技术进一步提高端口的带宽。以前的网络设备基本上都是采用半双工的工作方式，即当一台主机发送数据包的时候， 它就不能接收数据包，当接收数据包的时候，就不能发送数据包。由于采用全双工技术，即主机在发送数据包的同时，还可以接收数据包，普通的10M端口就可以变成20M端口，普通的100M端口就可以变成200M 端口，这样就进一步提高了信息吞吐量。

#### 交换机的工作原理

　　传统的交换机本质上是具有流量控制能力的多端口网桥，即传统的（二层） 交换机。把路由技术引入交换机，可以完成网络层路由选择，故称为三层交换，这是交换机的新进展。交换机（二层交换）的工作原理交换机和网桥一样，是工作在链路层的联网设备，它的各个端口都具有桥接功能，每个端口可以连接一个LAN或一台高性能网站或服务器，能够通过自学习来了解每个端口的设备连接情况。所有端口由专用处理器进行控制，并经过控制管理总线转发信息。

　　同时可以用专门的网管软件进行集中管理。 除此之外，交换机为了提高数据交换的速度和效率，一般支持多种方式。

（1）存储转发：

　　所有常规网桥都使用这种方法。它们在将数据帧发柱其他端口之前，要把收到的帧完全存储在内部的存储器中，对其检验后再发往其他端口，这样其延时等于接收一个完整的数据帧的时间及处理时间的总和。如果级联很长时，会导致严重的性能问题，但这种方法可以过滤掉错误的数据帧。

（2）切入法：

　　这种方法只检验数据帧的目标地址，这使得数据帧几乎马上就 可以传出去，从而大大降低延时。

　　其缺点是：错误帧也会被传出去。错误帧的概率较小的情况下，可以采用切入法以提高传输速度。而错误帧的概率较大的情况下，可以采用存储转发法／以减少错误帧的重传。

#### 交换机的配置

　　我们下面以Cisco公司的Catlystl900交换机为例，介绍交换机的一般配置过程。

　　对一台新的Catlystl900交换机，使用它的缺省配置就可以工作了。这因为它是一种将软件装在FlashMemory中的硬件设备，当加电时，它首先要进行一系列自检，对所有端口进行测试之后，交换机就处于工作状态。这时它的交换表是空的，它可以通过自学习来了解各个端口的设备连接情况，并将设备的 MAC地址记录在交换表中，当有信息交换时，交换机就根据交换表来进行数据转发。

　　但为了便于对它进行网络管理，Catlystl900交换机自己有一个MAC地址，这样就可以为它分配一个IP地址和屏蔽码。网络管理员须通过交换机的串口接一台终端或仿真终端，才能为它指定一个IP地址，其缺省值是0．0．0．0。指定IP地址以后，网络管理员就可以通过网络进行远程管理了。Catlystl900交换机的配置界面是菜单形式，缺省配置下，它的所有端口都属于同一个VLAN，很多情况下都不需要作什么修改。

（1）将微机串口通过RS一232电缆与Cata1yst1900的Console口连接，运行仿真终端软件，Catalyst 1900 启动后。

（2）回车后，进入主菜单。

（3）按“S”键，进入系统配置菜单：（配置系统名，位置，日期）。

（4）在主菜单中按“N”键进入网络管理菜单。

（5）配置IP地置。

（6）配置SNMP参数。

#### 交换机的种类

　　交换机是**数据链路层设备**，它可将多个物理LAN网段连接到一个大型网络上，与网络类似交换机传输和溢出也是基于MAC地址的传输。由于交换机是用硬件实现的，因此，传输速度很快。传输数据包时，交换机要么使用存储---转发交换方式，要么使用断---通交换方式。目前有许多类型的交换机，其中包括ATM交换机，LAN交换机和不同类型的WAN交换机。

ATM交换机

　　ATM（Asynchronous Transfer Mode）交换机为工作组，企业网络中枢以及其它众多领域提供了高速交换信息和可伸缩带宽的能力。ATM交换机支持语音，视频和文本数据应用，并可用来交换固定长度的信息单位（有时也称元素）。企业网络是通过ATM中枢链路连接多个LAN组成的。

局域网交换机

　　LAN交换机用于多LAN网段的相互连接，它在网络设备之间进行专用的无冲突的通信，同时支持多个设备间的对话。LAN交换机主要是用于高速交换数据帧。通过LAN交换机将一个0Mbps以太网与一个100Mbps 以太网互联。

#### 路由器工作原理

路由器工作原理

传统地，路由器工作于OSI七层协议中的第三层，其主要任务是接收来自一个网络接口的数据包，根据其中所含的目的地址，决定转发到下一个目的地址。因此，路由器首先得在转发路由表中查找它的目的地址，若找到了目的地址，就在数据包的帧格前添加下一个MAC地址，同时IP数据包头的TTL（Time To Live）域也开始减数，并重新计算校验和。当数据包被送到输出端口时，它需要按顺序等待，以便被传送到输出链路上。

路由器在工作时能够按照某种路由通信协议查找设备中的路由表。如果到某一特定节点有一条以上的路径，则基本预先确定的路由准则是选择最优（或最经济）的传输路径。由于各种网络段和其相互连接情况可能会因环境变化而变化，因此路由情况的信息一般也按所使用的路由信息协议的规定而定时更新。

网络中，每个路由器的基本功能都是按照一定的规则来动态地更新它所保持的路由表，以便保持路由信息的有效性。为了便于在网络间传送报文，路由器总是先按照预定的规则把较大的数据分解成适当大小的数据包，再将这些数据包分别通过相同或不同路径发送出去。当这些数据包按先后秩序到达目的地后，再把分解的数据包按照一定顺序包装成原有的报文形式。路由器的分层寻址功能是路由器的重要功能之一，该功能可以帮助具有很多节点站的网络来存储寻址信息，同时还能在网络间截获发送到远地网段的报文，起转发作用；选择最合理的路由，引导通信也是路由器基本功能；多协议路由器还可以连接使用不同通信协议的网络段，成为不同通信协议网络段之间的通信平台。

一般来说，路由器的主要工作是对数据包进行存储转发，具体过程如下：

第一步：当数据包到达路由器，根据网络物理接口的类型，路由器调用相应的链路层功能模块，以解释处理此数据包的链路层协议报头。这一步处理比较简单，主要是对数据的完整性进行验证，如CRC校验、帧长度检查等。

第二步：在链路层完成对数据帧的完整性验证后，路由器开始处理此数据帧的IP层。这一过程是路由器功能的核心。根据数据帧中IP包头的目的IP地址，路由器在路由表中查找下一跳的IP地址；同时，IP数据包头的TTL（Time To Live）域开始减数，并重新计算校验和（Checksum）。

第三步：根据路由表中所查到的下一跳IP地址，将IP数据包送往相应的输出链路层，被封装上相应的链路层包头，最后经输出网络物理接口发送出去。

简单地说，路由器的主要工作就是为经过路由器的每个数据包寻找一条最佳传输路径，并将该数据包有效地传送到目的站点。由此可见，选择最佳路径策略或叫选择最佳路由算法是路由器的关键所在。为了完成这项工作，在路由器中保存着各种传输路径的相关数据——路由表（Routing Table），供路由选择时使用。上述过程描述了路由器的主要而且关键的工作过程，但没有说明其它附加性能，例如访问控制、网络地址转换、排队优先级等。


ARP全称 地址解析协议在局域网内信息是以帧传输的。要记住地址就要有一个ARP缓存表，大概是几分钟刷新一次我忘记了。保存的就是当前局域网内与你连接的机器的IP和MAC的地址。ARP—a就可以查看到这个表。第一个是IP。第二个是网卡地址。第三个是连接类型。

#### **交换机如何学习MAC地址的**

​    假设一个交换机刚刚启动，MAC表完全是空的，局域网内有两台主机PC1和PC2，IP地址为192.168.0.1和192.168.0.2：那么交换机接到1端口的PC1的第一个数据帧，因为PC1只知道PC2的IP地址而不知道PC2的MAC地址，所以源IP地址为192.168.0.1源MAC地址是0000-0000-0001，目标IP地址为192.168.0.2而目标MAC地址是FFFF-FFFF-FFFF（此报文为ARP请求报文，是二层广播报问），**交换机首先将源MAC地址和相对应的端口记录在MAC表中，然后把这个数据帧从所有活动的端口转发出去，**；假设PC2在2端口接收到数据帧对数据进行回应时，则目标MAC地址为0000-0000-0001源MAC地址为0000-0000-0002。此时交换机收到数据帧后，首先学习PC2的MAC地址和对应端口到MAC表，然后查找MAC地址表中是否有PC1的MAC地址，发现目标MAC地址对应端口1，则将此数据帧由交换机的1端口转发出去。此时PC1和PC2的MAC地址都已记录在交换机MAC表中，数据在开始正常转发。所以，交换机在转发数据帧的过程，就是查找目标MAC地址，学习源地址的过程，希望你能理解！

## 六 计算机网络与因特网发展史

MIT, 兰德公司, NPL推动了分组交换技术的研究与发展, 而分组交换技术奠定了因特网发展的基础. 



## 章总结

习题

主机和自主计算机的集合

语法syntax - 格式和结构, 语义semantics 含义和控制信息, 时序timing 顺序

个域网:个人终端设备间互联, 局域网: , 城域网, 广域网.

星形, 总线, 环形, 网状, 树形, 复合;





# 第二章 网络应用

学习目标

## 一 计算机网络体系结构



### 1, 客户/服务器(C/S)结构网络应用

### 2, 纯P2P结构网络应用

### 3, 混合结构网络应用



## 二 网络应用的通信基本原理

网络应用的本质是运行在不同主机上(当然也可以运行在同一主机上)的应用进程之间的通信. 无论哪种类型的网络应用, 基本通信方式都是 `C/S` 通信, 因此网络应用的基本通信过程就是运行在不同主机上的应用进程间以C/S方式进行的通信. 

**通常服务器进程套接字会分配特定的端口号, 而客户进程的套接字会绑定一个随机的唯一端口号.** 

**IP地址是 Internet的网络层地址, 用于唯一标识一个主机或路由器接口**

**网络应用需要使用传输层提供端到端的传输服务, 不同应用对传输层服务有不同的服务性能需求, 有的应用期望传输层提供可靠的数据传输服务, 有的应用期望传输层提供延时保障服务**

### 快速理解

## 三 域名系统(Domain Name System, DNS)

### 1, 层次化域名空间

### 2, 域名服务器

### 3, 域名解析过程

本地域名, 顶级, 跟域名

域名解析分为 **递归解析** 和 **迭代解析**

域名系统查询效率改进策略



## 四 万维网应用, Web应用



### 1, 万维网应用结构

万维网(World Wide Web, WWW)

特点: 操作简单, 按需浏览, 图形化界面

Web页面由对象组成. 一个对象通常分别存储为一个文件, 

Web应用中, 通过一个URL地址来寻址一个Web页或Web对象

URL的组成: 域名 + 路径 + 参数

URL寻址方式确保万维网上的每个Web页面或对象都有一个唯一标识符. 

### 2, HTTP

(超文本传输协议, HyperText Transfer Protocol)

#### 2.1-概述

定义1: Web应用的应用层协议, 定义浏览器如何向Web服务器发送请求以及Web服务器如何向浏览器进行响应. 

版本: http/1.1 http/2 http/1.0

#### 2.2-HTTP连接

> 根据封装思维, 越上层是越丰富, 多样化越严重
>
> HTTP > TCP > IP > ARP 

HTTP基于传输层的TCP传输报文.

- 非持久连接: 发送报文, 接受响应报文, 断开连接. 每个资源建立一次连接
- 并行连接: 建立多条并行的TCP连接
- 持久连接: 重用已建立的TCP连接, 以节省TCP连接的时间和性能开销
  - 非流水方式持久连接:
  - 流水方式持久连接:

#### 2.3-HTTP报文

- 报文构成

  - 起始行(start line)
  - 首部行(header lines)
  - 空白行(blank line)
  - 实体主体(entity body)

- 报文分类/结构

  - 请求报文
    - 请求行/起始行(start line)
    - 首部行/请求头(header lines)
    - 空白行/空行(blank line)
    - 实体主体/请求体(entity body)
  - 响应报文
    - 状态行
    - 首部行
    - 空白行
    - 报文主体

- 请求方法

  - GET: 请求读取由URL所表示的信息, 是最常见的方法. 
  - HEAD
  - POST
  - OPTION
  - PUT: 在指明的URL下存储一个文档

- 状态码分类

  - 1XX: 提示
  - 2XX: 成功
  - 3XX: 重定向
  - 4XX: 客户端错误
  - 5XX: 服务器错误

- 常见状态码

- | 状态码 | 短语 | 含义 |
  | ------ | ---- | ---- |
  | 100    |      |      |
  | 200    |      |      |
  | 301    |      |      |
  | 400    |      |      |
  | 401    |      |      |
  | 403    |      |      |
  | 404    |      |      |
  | 451    |      |      |
  | 505    |      |      |

### 3, Cookie 小型文本文件

[cookie机制详谈](https://www.jianshu.com/p/2879fb0a5b2e)

HTTP服务器在向客户发送请求的文件后, 不保存任何关于该客户的状态信息. 

Cookie 是由服务端生成, 发送给User-Agent(一般是浏览器), 浏览器会将Cookie的key/value保存到某个目录下的文本文件内, 下次请求同一网站时就发送该Cookie给服务器(前提是浏览器设置为启用Cookie)





#### 机制理解

浏览器在发送请求报文时, 浏览器会自动检索本地的cookie文件, 并在每个请求报文中通过 Cookie 头行(位于请求头 header lines中). 网站(服务器)再基于该Cookie值, 实现相应的功能

网站/服务器: 后台数据库中存储, 维护Cookie信息, 数据库字段包括用户ID, 用户在本网站的特征等.

用户在首次请求时, 为该用户在数据库表中创建该用户的记录, 以用户ID为唯一键, 并通过响应报文中的响应头的Set-Cookie 发送给用户. 交由浏览器对其进行本地存储, 维护和管理Cookie文件

Cookie内容一般包含: 域(domain), 路径(path), 有效期(spires)



### Cookie一些用途

- 利用cookie ID 来统计访问信息, 访问人数, 新访问者, 重复访问等
- 利用Cookie机制限定某些特定用户进行访问
- 存储用户访问过程中的操作习惯和偏好, 对不同的用户呈现出不同的显示内容, 界面等. 有针对性的为用户提供服务, 提升用户体验感
- 记录用户登录信息
- 实现购物车功能

### 缺点

会出现一定的安全问题, 

## 五 Internet电子邮件

> 一个,明显的特征是异步传输

### 1, 电子邮件系统结构

邮件服务器, 简单邮件传输协议(SMTP), 用户代理和邮件读取协议

常见的用户代理: outlook, fox mail, gmail, 网易邮箱

### 2, 邮件传输协议 SMTP

### 3, 电子邮件格式与MIME

### 4, 邮件读取协议

主动从服务器中拉取, 主动请求收信



#### 4.1, POP3

#### 4.2-IMAP

#### 4.1, HTTP

**邮件服务器之间的发送和接收过程依然使用SMTP**

## 六 FTP

文件传送协议(File Transfer Protocol, FTP) 应用层协议FTP

基于TCP传输

主进程(用户连接管理) + 多个从属进程(单个文件传送管理)

控制连接和数据连接 并行连接

数据传输完成后关闭连接

显然, 一个端口可以对应多个TCP连接

一个TCP连接可以有多个请求, 可以

## 七 P2P应用

P2P体系结构

纯P2P来讲, 整个应用体系几乎不依赖某个集中服务器, 应用都是动态地在对方之间进行. 

服务提供方: 桌面计算机, 笔记本电脑, 服务器等.

特点:充分聚集利用了端系统的计算能力以及网络传输带宽(对等方接入网络的带宽), 代表了全新的网络应用架构与理念.  端系统既是客户端也是服务端(去中心化)

## 八 Socket编程基础

典型的网络应用是由一对程序组成的, 分别位于两个不同的端系统中, 当运行这两个程序时, 便创建了一个客户进程和一个服务器进程, 同时它们通过从套接字读出或写入数据, 完成彼此之间的通信

网络应用进程通信时需要通过API接口请求**底层协议的服务**, 传输层服务, 目前在Internet中应用最广泛的网络应用编程接口就是Socket API.











## 章总结







# 第三章 传输层

学习目标

## 一 传输层的基本服务

### 1 传输层功能

- 传输层寻址
- 对应用层报文进行分段和重组
- 对报文进行差错检测
- 实现进程间的端到端可靠数据传输控制;
- 面向应用层实现复用与分解
- 实现端到端层的流量控制
- 拥塞控制

### 2, 传输层寻址与端口

传输层为应用进程之间提供端到端的逻辑通信服务

计算机中, 进程是用进程标识符(进程ID)来标识的. 

网络环境下, 需要使用统一的方法对网络应用进程进行标识, 而这种方法必须与特定的操作系统无关.

不同主机, 不同系统上进行进程间通信, 需要统一的方法对应用进程进行标识. 

TCP/IP体系结构网络的解决方法就是在传输层使用**协议端口号**(protocol port number), 通常简称为端口, 在全网范围内利用 "IP地址+端口号" 唯一标识一个通信端点. IP标识主机, 端口标识唯一对应的应用进程

这是抽象端口, 与路由器或交换机上的硬件端口是完全不同的概念. 

软件端口是应用层的各种 **应用协议进程** 与 **传输层协议实体** 进行**层间交互**的一种地址

熟知端口号, 登记端口号, 动态端口号(协议端口号, 不是进程端口号, 也不是应用端口号)



### 3, 无连接服务与面向连接服务

无连接, 直接构造传输层报文段并想接收端发送

面向连接 是指数据传输之前先建立逻辑连接



## 二 传输层的复用与分解

多路复用, 多路分解, 

多个应用进程共用一个传输层协议, 并能将接收到的数据准确交付给不同的应用进程, 需要实现传输层的多路复用与多路分解, 复用与分解

*[ 其他层协议(比如IP), 也需要完成这一功能 ]*

多应用进程复用: 多个应用进程同时利用同一个人传输层协议(TCP/UDP)进行网络通信.

多路分解: 传输层接收报文时, 可能封装了不同应用进程的数据, 传输层协议需要(<u>通过正确的端口</u>)将数据交付给正确的应用进程. 实现复用与分解的关键是 **传输层协议能够唯一标识一个套接字** 一个套接字对应一个连接

### 3, 面向连接的多路复用与多路分解

一个进程对应一个HTTP连接

<源IP, 源Port, 目标IP, 目标Port>

## 三 停-等协议与滑动窗口协议

TCP 发送的报文是交给IP传送的

IP只能提供"尽力best effort"服务, 不可靠的数据报传输服务

显然, TCP必须采取适当的措施,才能使其在基于不可靠的网络层的基础上, 实现可靠数据传输, 为应用层提供可靠报文传输服务.

### 1, 可靠数据传输基本原理(也适用于其它层)



- 不可靠传输信道 的主要表现:

  - 传输过程中,比特差错(0,变成1, 1变成0)
  - 乱序(先发送的后到达, 后发送的先到达)
  - 数据包丢失

- 实现可靠传输的主要措施:

  - 差错检测: 利用**差错编码**实现数据包传输过程中的比特差错检测. (附加冗余信息, 与数据逻辑关联)
  - 确认:接收方向发送方反馈接收状态
  - 重传: 发送方重新发送接收方没有正确接收的数据
  - 序号: 确保数据按序提交.(不用担心乱序到达的问题, 按序提交即可)
  - 计时器: 解决数据丢失问题

  停等协议和滑动窗口协议 同样适用于其他层

### 2, 停-等ARQ协议

连续ARQ协议, 重传ARQ协议

肯定确认 `ACK` 否定确认 `NAK` 基于这种重传机制的可靠数据传输协议称为 **自动重传请求协议(Automatic Repeat reQuest, ARQ)** 最简单的ARQ协议就是停-等协议.

- 特点
  - 每发送一个**报文段(传输层)**后就停下来等待接收方的确认, 
- 基本工作过程: 
  - 发送方发送经过差错编码和编号的报文段, 等待接收方确认
  - 接收方如果正确接收报文段
- 细节说明
  - PKT0 PKT1 PKT0 PKT1 上一个, 下一个, 上一个, 下一个
  - 差错检测. ACK / NAK 同样需要差错检测 - **差错编码**
  - 序列号. 只需要一位就够了, 标识是新报文还是重传报文 - **报文段增加序列号段** 0 新发 1 重传 差错检测正确就送到上一个层级
  - ACK和NAK. 一般不使用NAK, 只使用ACK进行确认 不是ACK0 就重传, ACK1需要重传 - **只用ACK+ 序号标识**
  - ACK/NAK 差错. 在ACK或NAK中**增加差错编码** 只要有差错, 不管是不是ACK差错 都视为未正确接收. 这时候会出现重复报文段 但是可以通过报文段的
- 总结: 停-等协议综合应用了差错检测, 确认, 重传, 序号, 计时器等措施, 每种措施都在协议的运行中起到了至关重要的作用, 实现了可靠数据传输.
- 特点: 简单, 所需缓存存储空间小
- 缺点:虽然功能正确, 但是性能较差, **停-等机制降低了信道利用率**
- **信道利用率U~Sender~**: 单位报文段发送方实际利用信道发送数据的时间与总时间  
  - *--信道实际利用时间/信道占用时间*
- t~Seg~: 传输时延 L/R
- RTT: 传播时延
- t~ACK~: 分组时延

$$
U_{Sender}= \frac{t_{Seg}}{t_{Seg}+RTT+t_{ACK}}
$$





### 3, 滑动窗口协议

传输时延越长, 信道利用率越低, 再加上排队的时延, 性能更加糟糕

解决这种问题的简单方法 **流水线协议/管道协议**: 不使用停等协议的停止-等待运行方式, 允许发送方在没有收到确认前连续发送多个分组. 从发送方向接收方传送的系列分组可以看成是填充到一条流水线/管道中.

相较于停等协议的改进

1, 必须增加分组序号范围

2, 协议的发送方和(或)接收方必须缓存多个分组

最典型的流水线可靠传输协议是**滑动窗口协议**: 对分组进行连续编号, 发送方按流水线方式依序发送分组; 接收方接收分组, 按分组序号向上有序提交, 并通过确认向发送方通过正确接收的分组序号(或通过否定确认通过出现差错的分组序号). **发送方对于已经发送单还没有收到确认的分组,必须缓存, 以便从缓存的 分组中重发**

**接收方任务**: 确保按序向上层提交正确的分组, 按序的正常提交, 未按序的无差错分组缓存或丢弃(取决于接收方的缓存能力), 并确认; 对于受到的差错分组进行合理确认(肯定确认或否定确认)

滑动窗口协议实质上就是将可靠数据传输的工作过程, 抽象到分组序号空间, 即**发送方确保分组按序发送, 接收方确保分组按序提交.** 滑动窗口协议的发送方和接收方各维护一个窗口 sender receiver 分别称为发送窗口W~s~和接收窗口W~r~

数据产生和提交都是一个一个的提交的

发送窗口 一次可以发送的最大窗口

接收窗口 一次可以缓存的最大窗口

**特点**: 根据采用的确认机制, 计时机制及窗口大小机制等的不同, 可以有不同类型的滑动窗口协议设计

最具代表性的滑动窗口协议是:

回退N步协议(Go-Back-N,GBN) 和 选择重传协议(Selective Repeat, SR)

#### GBN协议

特点:W~s~>=1, W~r~=1. 当出现差错时 需要重发给分组及该分组之后的所有分组

缺点: 

#### SR协议

说明:通过让发送方仅重传那些未被接收方确认(出错或丢失)的分组, 而避免了不必要的重传. SR协议的接收方是对每个正确接收的分组进行逐个确认.

特点1: 增加接收方缓存能力(W~r~>=1), 缓存正确达到但失序的分组, 改进协议的性能. 很多SR协议涉及取相同的发送窗口和接收窗口大小

特点2: SR协议的发送方可以连续发送多个分组, 每个分组在当前发送窗口中必须有唯一的编号. 

- SR发送方主要响应3个事件, 并完成相应操作:
  1. 上层调用, 请求发送数据;
  2. 定时器超时;
  3. 收12到ACK~n~;收到ACK, 对确认的序号n进行判断
- **SR接收方**的主要操作
  1. 正确接收到序号在接收窗口范围内的分组PKT~n~;
  2. 正确接收到序号在接收窗口左侧的分组PKT~n~; *--目的: 避免极端情况下协议处于死锁状态,即发送方和接收方的窗口无法继续滑动*
  3. 其他情况, 接收方可以直接丢弃分组, 不做任何响应.

 

SR协议的信道利用率:


$$
U_{Sender}= \frac{W{_s}×t_{Seg}}{t_{Seg}+RTT+t_{ACK}}
$$
当W~s~=1时,即为停-等协议的信道利用率

当W~s~足够大时, 可以时 $W_s×t_{Seg}$ ≧ $t_{Seg}+RTT+t_{ACK}$ 成立, 此时信道利用率为100%



## 四 用户数据报协议(UDP)

UDP是 Internet传输层协议, 提供无连接, 不可靠, **数据报尽力**传输服务. 

应用场景:主机DNS应用程序进行一次域名查询

- 传输过程: 
  - (应用层)主机构造DNS查询报文并将其交给UDP; 
  - (传输层)UDP为此报文添加首部字段生成UDP报文段, 然后将报文段交给网络层
  - (网络层)将UDP报文封装进一个IP数据报, 然后将其发生给一个域名服务器.
  - 主机根据查询报文作出响应
- 优势和应用场景
  - 应用进程更容易控制发送什么数据以及何时发送
  - 无需建立连接
  - 无连接状态
  - 首部开销小. TCP 首部20字节, UDP首部字需要8个字节

虽然UDP提供不可靠传输服务, 但使用UDP的应用仍然可以实现可靠数据传输. 应用进程可以使用UDP的同时进行可靠通信, 只是需要**应用层设计可靠传输机制**而已

### UDP数据结构

![page_1](https://wwfyde.oss-cn-hangzhou.aliyuncs.com/images/20210426192425.png)

长度字段指示了在UDP报文中的字节数(首部和数据的总和),

接收方使用校验和来检测该报文是否出现了差错.

实际上, 计算校验和时, 除了UDP报文段以外还包括了IP首部的一些字段

### UDP校验和

UDP校验和提供了差错检测功能. 也就是说, UDP的检验和用于检查UDP报文段从源

参与UDP校验和计算的内容包括3部分: UDP伪首部, UDP首部和应用层数据

UDP伪首部: 源IP, 宿IP, 全0, 协议号(17), UDP长度(UDP数据报的字段长度, 因此会参与两次计算)

*[ 套接字 将报文 封装成报文段(包含IP报) ]*

最好需要取反

虽然UDP提供差错检测, 但是它没有差错恢复能力, 只是简单地丢弃差错报文段, 或者将受损的报文段交给应用程序并给出警告, 由应用程序决策如何处理差错报文段

## 五 传输控制协议(TCP)

传输层协议, 吧把应用程序交付的数据抽象为无结构的字节流

特点: 提供面向连接, 可靠, 有序, 字节流服务

- 可靠传输措施
  - 差错检测
  - 重传
  - 累积确认
  - 定时器
  - 序号和确认序号

特点: 

特点: 接收方应用程序收到的字节流必须和发送方应用程序发出的字节流完全一样.

接收方的应用程序必须有能力识别收到的字节流, 把它还原成有意义的应用层数据

TCP提供全双工通信服务

### 1, TCP报文结构

TCP连接的两端都设有发送缓存与接收缓存, 用来临时存放双向通信的数据

- TCP首部为 20字节的固定首部 + 可选长度

### 2, TCP连接管理

建立连接, 拆除连接

### 3, TCP可靠数据传输

IP协议本身是 不可靠尽力传输服务

**TCP在提供不可靠尽力服务的IP之上实现端到端的可靠数据传输**

可靠传输的核心目标是: 发送端的发送的字节流与接收端的字节流是完全相同的, 确保一个进程从其接收缓存中读取的数据流是无差错, 无缺失, 无冗余以及无乱序的字节流

#### 特点

基于滑动窗口协议, 但是发送窗口大小动态变化

> window窗口

TCP发送窗口: W~s~

流量控制窗口(接收端通告的接收窗口): RcvWin

拥塞控制窗口:CongWin
$$
W{_s}=min(RcvWin, CongWin)
$$


#### 实现机制

> 工作机制, 实现原理

1. 分割数据库, 封装成TCP段, 传递给IP;
2. 发出TCP段后, 启动计数器, 等待目的端确认收到这个报文. 如果未收到确认则重发;
3. 收到的报文段通过校验和检测数据在传输过程中是否发生差错, 已收到的数据最后一个字节的序号加1作为确认序号, 向发送方发送确认段;
4. IP数据报的达到<u>路径不同造成错乱顺序</u>, TCP根据序号对收到的数据进行重新排序, 将收到的数据以正确的顺序交给应用层;
5. 由于<u>网络延迟和重传机制</u>, 根据序号丢弃重复报文;
6. TCP可提供<u>流量控制</u>, TCP连接的每一方都在建立连接时分配一定大小的接收缓冲空间. TCP的接收端只允许另一端发送接收端缓冲区所能接纳的数据. 这可以防止较快主机发送数据太快, 致使较慢主机的缓存区溢出(接收端可以主动控制流量传输速率)

#### 传输控制*发送方*主要事件

- 从上层应用程序接收数据: 分为 <u>缓存</u> 和 <u>发送</u> 两个任务

- 定时器超时: 合理的超时时间设置

  - 过短不必要的重传, 过长丢失响应缓慢, 影响性能

  - 任意时刻的报文RTT采样(SampleRTT)

  - 加权移动平均值(EstimatedRTT) `α`的典型值为0.125
    $$
    EstimatedRTT=(1-α)·EstimatedRTT + α·SampleRTT
    $$

- 收到ACK

### 4, TCP连接控制

### 5, TCP拥塞控制

## 知识概念

SYN(同步	, synchronize)

SEQ(序号, Sequence)

RTT(传播时延)

Estimate(估计)

## 章总结



# 第四章 网络层

网络层是**网络核心的最高层** *[网络核心不关心传输层和应用层]*

是实现大型网络互连的关键, 是网络体系结构中最重要的一层

## 学习目标

1. 理解 网络层 **服务模型** 以及 **转发** 与 **路由** 的概念;
2. 理解 **虚电路网络**  与 **数据报网络** 的特点及其工作过程;
3. 理解 **网络互连** , **异构网络** 的概念, 并掌握实现网络互连的设备路由器的基本结构;
4. 理解 **网络拥塞产生的原因** 以及 网络层进行 **拥塞控制** 的方法;
5. 掌握 Internet网络层, 包括IPv4, ICMP, DHCP, NAT, IP地址, 子网划分, 路由聚合等, 了解IPv6;
6. 掌握 典型的 **路由算法** 及典型的 **路由选择协议** (RIP, OSPF, BGP)



## 一 网络层服务

网络层: 将承载传输层报文段的网络层数据报从源主机送达目的主机. 

网络层需要实现: **转发**(<u>forwarding</u>) 和 **路由**(<u>routing</u>) 两大功能

转发:

路由:



## 一 网络层服务

## 二 数据报网络与虚电网络

## 三 网络互连与网络互连设备

## 四 网络层拥塞控制

## 五 Internet网络层

## 六 路由算法与路由协议

# 第五章 数据链路层与局域网

## 学习目标

第五章数据链路层与局域网
【学习目标】
1.理解数据链路层的基本功能与服务。
2.理解差错编码的基本原理，掌握典型的差错编码。
3.理解多路访问控制协议的作用与原理，掌握典型的MAC协议。
4.理解多路复用的概念与技术，掌握CDMA的基本原理。
5.掌握MAC地址、ARP、以太网、CSMACD协议。
6.理解虚拟局域网（VLAN）基本原理。
7.掌握交换机的特点及其工作原理。
8.掌握PPP工作原理，了解HDLC协议。
【教师导读】
本章主要介绍数据链路层的基本功能与服务，<u>差错编码</u>的基本原理与技术，多路访问控制协议的作用与原理，TMA、FDMA、WDMA、CDMA工作原理， ALOHA、CSMA、 CSMACD及受控接入MAC协议工作原理，数据链路层寻址，MAC地址，ARP，以太网，典型网络互连设备的特点及其工作原理，LC协议与PPP工作原理等内容。
本章重点是掌握典型的差错编码，CDMA工作原理， ALOHA、CMA、 CSMACD及受控接入MAC协议的工作原理，MAC地址ARP，以太网，交换机的特点及其工作原理，PPP工作原理等内容；难点是CDMA工作原理、 CSMACD协议、以太网、交换机工作原理、VLAN工作原理等。
这一章学习的关键是深入理解差错编码、MAC协议、ARP、以太网、交换机、LAN和PPP等内容。
【建议学时】8学时。

## 基本概念

- 节点 : 数据链路的端点. 
- 链路 : 节点间的通信信道.



## 一 数据链路层服务

信号的转置, 虽然别人的信号不会懂, 但是可以通过协议来使得大家之间可以相互交流

<u>数据链路层</u> : 负责通过一条链路，从一个节点向另一个物理链路直接相连的相邻节点，传送网络层数据报，中间通常不经过任何其他交换节点。

**网络层数据报被封装到数据链路层的帧中传送。**

数据链路是在物理线路之上，基于通信协议来控制数据帧传输的逻辑数据通路.

实现数据链路层（协议）功能的典型硬件实体是<u>网络适配器</u>（NIC，即网卡），**网络适配器实质上需要实现数据链路层和物理层的功能。**本章将介绍数据链路层的主要功能、差错编码、多路访问控制协议（MAC协议）、以太网、交换机等内容。

## 二 差错控制

## 三 多路访问控制协议

多路访问控制(Multipe Access Control, MAC)

## 四 局域网



MAC地址(Midea Access Control Address): 物理地址, 以太网地址, 局域网地址

## 五 点对点链路协议

# 第六章 物理层

## 学习目标

## 一 数据通信基础

从物理层角度看, 计算机网络通信的本质就是 **数据通信**



信息: 对事物状态或存在方式的不确定性表述 

## 二 物理介质

## 三 信道与信道容量

**信道**: 信号在通信系统中传输的通道, 由信号从发射端(信源)传播到接收端(信宿)所禁果的传输介质构成.

无线通信的信道就是电磁波传播所通过的空间, 有限

## 四 基带传输

## 五 频带传输

## 六 物理层接口规程

## 章总结

本章介绍无线链路和无线网络特性、移动网络基本原理、无线局域网iEEE802.11、蜂窝网络、移动IP网 WiMax络、蓝牙、 ZigBee等内容。

无线网络基本组成包括无线主机、基站、无线链路和网络基础设施。无线网络模式包括基础设施模式和自组织网络模式，主要区别在于基础设施模式无线网络中有基站，而自组织网络没有基站。无线链路的特殊性，决定了无线网络有一些不同于有线网络的特性，比如隐藏站问题。

移动网络首先一定是无线网络。移动网络实现移动节点寻址的基本策略包括间接路由选择和直接路由选择。间接路由选择对通信方来说，通信过程透明，但存在三角路由问题，很多移动网络采用间接路由策略。直接路由可以避免三角路由问题，但对通信方不透明。移动节点在移动过程中会用到两个地址，一个是永久地址，另一个是转交地址。归属代理和外代理实现移动节点的移动跟踪与管理。

IEEE802.11是目前应用最广泛的无线局域网技术。一个EEE802.11无线局域网，包括移动主机、AP、无线链路和网络基础设施。一个AP以及与之关联的无线主机构成一个基本服务集（BSS）。无线主机可以通过主动扫描或被动扫描的方式与AP进行关联EE802.11的MAC协议是 CSMACACSMA/CA通过RTs和CTS帧的交换，可以有效避免隐藏站问题，实现信道的预约，从而有效避免数据帧传输过程中的冲突。另外， CSMACA采用确认帧对成功接收的数据帧进行确认。EEE80211帧比较特殊的一点是帧中有4个地址字段，其中地址1、地址2和地址3在不同情形下取值不同，地址4多用于自组织网络模式。

蜂窝网络是典型的移动通信网络，其基本组成主要包括移动台（移动终端）、基站、无线链路（空中接口）、基站控制器、移动交换中心和基础设施网络等。蜂窝网络移动性管理采用的是间接路由选择。实现移动管理的实体包括HLR和VR，移动台主要涉及两个号码，手机号和漫游号。目前，移动通信网络已由1G、2G、3G发展到目前主流的4G网络，技术也由最初的FDMA，经历了FmtDMA、CDMA，发展到4G网络的OFDMA和MIMO等新技术。最新一代的移动通信网络，即5G网络也即将走入人们的生活

移动IP包括3部分:代理发现、注册以及间接路由选择。代理发现通过捕获归属代理或外代理定期发送的代理通告ICMP报文，发现归属代理或外代理。注册是完成向外代理注册移动节点的永久地址，并向归属代理注册COA.移动IP采用间接路由选择实现移动性。

# 第七章 无线与移动网络



## 一 无线网络

## 二 移动网络

## 三 无线局域网 IEEE 802.11

## 四 蜂窝网络

## 五 移动IP网络

## 六 其他典型无线网络简介

























# 第八章 网络安全基础

## 学习目标

理解防火墙的基本概念与原理

## 一 网络安全概述

### 1, 基本概述

常见网络安全问题: 网络入侵, 拦截, 删除, 添加恶意信息

网络安全的核心课题是: 防止网络入侵

- 网络安全通信所需基本属性
  **机密性** , **身份认证** , **消息完整性** , 和 **可访问性与可用性** 等 
  - 机密性: 只有发送方与预定接收方能够理解报文内容
  - 消息完整性: 发送方与接收方希望确保消息未被篡改(传输途中或后期), 发生篡改一定会被检测到
  - 可访问性与可用性: 网络信息可被授权实体访问并按需求使用的特性
  - 身份认证: 发送方与接收方希望确认彼此的真实身份

### 2, 网络安全威胁

- 文件传输时, 窃听, 插入, 假冒, 劫持等
- DOS 和DDoS攻击
- 映射
- 嗅探
- IP欺骗: 直接由应用生成 "原始" IP分组



## 二 数据加密

实现网络安全的基础是 **数据加密**

密码学概念

明文: 未加密消息

加密: 伪装以隐藏消息的过程

密文: 已加密的消息

解密: 密文转为明文的过程

### 传统加密方式

替代密码

换位密码

### 对称密钥加密

加密密钥和解密密钥是相同的

缺点: 密钥被窃取后, 算法一般又是公开的, 整个密钥将变得毫无意义, 需要对密钥进行重点保护

### 非对称/公开密钥加密

通过公钥加密的报文, 只能通过私钥才能得到明文

典型的公开密钥加密算法 RSA :

公开密钥咪猫有一个重要特性:如果对报文m利用 



## 三 消息完整性与数字签名

消息完整性检查 

`MD5` / `SHA-1`

功能/作用/目的/目标: 验证报文在传输过程中没有被篡改; 预防报文的时间, 顺序被篡改; 预防报文持有期被篡改; 预防抵赖

### 1, 消息完整性检测方法

### 2, 报文认知

### **3, 数字签名**



## 四 身份认证

身份认证又称身份鉴别, 是一个实体经过计算机网络向另一个实体证明其身份的过程

**人**向某个**电子邮件服务器**证明其身份

鉴别基础:  报文和数据交换

鉴别方式: 用 口令(token)鉴别身份, 会过期的随机数

## 五 密钥分发中心与证书认证机构

## 六 防火墙与入侵检测系统

### 1, 防火墙基本概念

发挥作用的前提: 从外部到内部和从内部到外部的所有流量都经过防火墙, 并且仅被授权的流量允许通过, 防火墙能够限制对授权流量的访问

### 3, 入侵检测系统

## 七 网络安全协议

### 安全套接字层(Security Socket Layer, SSL)



虚拟专用网VPN和IP安全协议IPSec

virtual private Networks, VPN





## 章总结



# TCP-传输控制协议

>  transmission control protocol

![1920px-Tcp_state_diagram_fixed_new.svg](https://wwfyde.oss-cn-hangzhou.aliyuncs.com/images/20210426193224.png)

## TCP的三次握手

> 目标: 知道TCP的3次握手是用于建立连接
>
> 同步应答机制, 
>
> SYN -- synchronize
>
> ACK -- acknowledge
>
> FIN -- Finish

所谓三次握手(Three-Way Handshake) 即建立TCP连接,(发送3个数据包) 该过程由客户端执行connect来触发

需要 发送数据 并且确认发送成功  并且 建立双向连接

白话

- 喂 你听得到我说话吗?
- 能听到, 你听得到我吗?
- 能听到
    实际流程:
    ![三次握手四次挥手](https://wwfyde.oss-cn-hangzhou.aliyuncs.com/images/20210426193229.jpg)

**三次握手的目的**: 是连接服务器指定端口，建立TCP连接,并同步连接双方的序列号和确认号并交换 TCP 窗口大小信息.
在socket编程中，客户端执行connect()时。将触发三次握手

第一次握手:

客户端发送一个TCP的SYN标志位置1的包指明客户打算连接的服务器的端口，以及初始序号X,保存在包头的序列号(Sequence Number)字段里。

第二次握手:
服务器发回确认包(ACK)应答。即SYN标志位和ACK标志位均为1同时，将确认序号(Acknowledgement Number)设置为客户的I S N加1以.即X+1。
(发回确认信息-做好可以接受状态配置)

第三次握手:
客户端再次发送确认包(ACK)SYN标志位为0,ACK标志位为1.并且把服务器发来ACK的序号字段+1,放在确定字段中发送给对方.并且在数据段放写ISN的+1

> **SYN攻击**: 在三次握手过程中，服务器发送SYN-ACK之后，收到客户端的ACK之前的TCP连接称为半连接(half-open connect).此时服务器处于Syn_RECV状态.当收到ACK后，服务器转入ESTABLISHED状态.
> Syn攻击就是 攻击客户端 在短时间内伪造大量不存在的IP地址，向服务器不断地发送syn包，服务器回复确认包，并等待客户的确认，由于源地址是不存在的，服务器需要不断的重发直 至超时，这些伪造的SYN包将长时间占用未连接队列，正常的SYN请求被丢弃，目标系统运行缓慢，严重者引起网络堵塞甚至系统瘫痪。
> Syn攻击是一个典型的DDOS攻击。检测SYN攻击非常的方便，当你在服务器上看到大量的半连接状态时，特别是源IP地址是随机的，基本上可以断定这是一次SYN攻击.在Linux下可以如下命令检测是否被Syn攻击
> netstat -n -p TCP | grep SYN_RECV
> 一般较新的TCP/IP协议栈都对这一过程进行修正来防范Syn攻击，修改tcp协议实现。主要方法有SynAttackProtect保护机制、SYN cookies技术、增加最大半连接和缩短超时时间等.
> 但是不能完全防范syn攻击。



![img](https://wwfyde.oss-cn-hangzhou.aliyuncs.com/images/20210426193236.png)

TCP的连接的拆除需要发送四个包，因此称为四次挥手(four-way handshake)。客户端或服务器均可主动发起挥手动作，在socket编程中，任何一方执行close()操作即可产生挥手操作。(发起方确认对方关闭了自己在关闭)

**为什么建立连接是三次握手，而关闭连接却是四次挥手呢？**
这是因为服务端在LISTEN状态下，收到建立连接请求的SYN报文后，把ACK和SYN放在一个报文里发送给客户端。
而关闭连接时，当收到对方的FIN报文时，仅仅表示**对方不再发送数据了, 但是还能接收数据**，己方也未必全部数据都发送给对方了，所以己方可以立即close，也可以发送一些数据给对方后，**再发送FIN报文给对方来表示同意现在关闭连接**，因此，己方ACK和FIN一般都会分开发送。

**请求方**:A发送关闭请求后,停止发送数据,但不会立即关闭接受数据服务. 

响应方:B收到对方的关闭数据请求后,一般会发送数据或收到信息确认指令 并 给出停止发送数据指令, 收到了请求,但不会立即执行或者说可以执行不关闭命令  

但任然处于可接收信息状态,等待确认B关闭接受信息服务指令(完全关闭状态),再发送同意关闭连接指令,并关闭发送数据服务(接受数据服务并未关闭),A在收到同意关闭连接指令后,发送确认将关闭接收数据服务,完全关闭,指令B也完全关闭,

## tcp长连接和短连接

TCP在真正的读写操作之前，server与client之间必须建立一个连接，当接收发送操作完成后，双方不再需要这个连接时它们可以释放这个连接，连接的建立通过三次握手，释放则需要四次握手，所以说每个连接的建立都是需要资源消耗和时间消耗的。

.1 短连接的操作步骤是：建立连接——数据传输——关闭连接...建立连接——数据传输——关闭连接(不断的重复连接)
3.2 长连接的操作步骤是：建立连接——数据传输...（保持连接）...数据传输——关闭连接(保持连接状态)

### TCP长/短连接的优点和缺点

- 长连接可以省去较多的TCP建立和关闭的操作，减少浪费，节约时间 占用服务器。
- 对于**频繁请求**资源的客户来说，较适用长连接。
- client与server之间的连接如果一直不关闭的话，会存在一个问题，随着客户端连接越来越多，server早晚有扛不住的时候，这时候server端需要采取一些策略，如关闭一些长时间没有读写事件发生的连接，这样可以避免一些恶意连接导致server端服务受损；如果条件再允许就可以以客户端机器为颗粒度，限制每个客户端的最大长连接数，这样可以完全避免某个蛋疼的客户端连累后端服务。
- 短连接对于服务器来说管理较为简单，存在的连接都是有用的连接，不需要额外的控制手段。
- 但如果客户请求频繁，将在TCP的建立和关闭操作上**浪费时间和带宽**。

### TCP长/短连接的应用场景

- **长连接多用于操作频繁，点对点的通讯，而且连接数不能太多情况**。
- 每个TCP连接都需要三次握手，这需要时间，如果每个操作都是先连接，再操作的话那么处理速度会降低很多，所以每个操作完后都不断开，再次处理时直接发送数据包就OK了，不用建立TCP连接。
- 例如：数据库的连接用长连接，如果用短连接频繁的通信会造成socket错误，而且频繁的socket 创建也是对资源的浪费。
- 而像**WEB网站的http服务一般都用短链接**，因为长连接对于服务端来说会耗费一定的资源，而像WEB网站这么频繁的成千上万甚至上亿客户端的连接用短连接会更省一些资源，如果用长连接，而且同时有成千上万的用户，如果每个用户都占用一个连接的话，那可想而知吧。
- 所以**并发量大**，但每个用户**无需频繁**操作情况下需用**短连接**好。

## TCP/IP简介

### 什么是协议(protocol)

统一的识别和通信标准,
有的说英语，有的说中文，有的说德语，说同一种语言的人可以交流，不同的语言之间就不行了为了解决不同种族人之间的语言沟通障碍，现规定国际通用语言是英语，这就是一个规定，这就是协议

### 计算机网络沟通用什么

现在的生活中，不同的计算机只需要能够联网（有线无线都可以）那么就可以相互进行传递数据

那么不同种类之间的计算机到底是怎么进行数据传递的呢？
就像说不同语言的人沟通一样，只要有一种大家都认可都遵守的协议即可，那么这个计算机都遵守的网络通信协议叫做TCP/IP协议

### TCP/IP协议(族)

因为互联网协议包含了上百种协议标准，但是最重要的两个协议是TCP和IP协议，所以，大家把互联网的协议简称TCP/IP协议(族)
![TCP-IPbf545.jpg](https://wwfyde.oss-cn-hangzhou.aliyuncs.com/images/20210426193247.jpg)

# IP协议

> [wiki](https://en.wikipedia.org/wiki/Internet_Protocol)
>
> 网络层协议

# HTTP-超文本传输协议

> [wiki](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol)
>
> HTTP协议的作用是 为了实现浏览器和服务器之间的通行
>
> HTTP协议的组成

## HTTP协议概念和特性

超文本传输协议(HTTP,HyperText, Transfer Protocol) 是互联网上应用最广泛的一种网络协议. 所有的www文件都**必须遵守这个标准**. 

设计HTTP的最初目的是为了提供一种发布和接收HTML文件的方法

HTTP是一个客户端和服务器请求和响应的标准(TCP).  
一般客户端是终端用户, 服务器端是网站. 
通过Web服务器, 爬虫工具和其他工具, 客户端发起一个到服务器上制定端口(默认端口为80)的HTTP请求

超文本传输协议是一种应用层协议

- 应用层: HTTP客户端/服务器  -- 负责处理特定的应用程序细节
- 传输层: TCP / UDP  --主要为两台主机上的应用提供端到端的通信
- 网络层: IP  --处理分组在网络上的活动,比如分组的选路
- 链路层: 网络 --设备驱动程序, 计算机中对应的网络接口卡

## 请求响应模式: request / response

TCP连接 --> 发送请求 --> 作出响应 --> 断开TCP连接

HTTP协议分为:**请求协议** 和 **响应协议**

协议是由一个一个的简单的协议项组成, 形式如下: 

协议名: 协议内容(值)

Host: www.google.com

**注意: 每一个协议项都应该单独占用一行**

### HTTP协议格式查看

> 使用谷歌浏览器查看HTTP协议格式

在web应用中,服务器把网页传给浏览器, 实际就是把网页的HTML代码发送给浏览器,浏览器解析显示出来. 而浏览器和服务器之间的传输应用层协议就是HTTP协议.

- HTML是一种用来定义网页的文本,会HTML就会编写网页
- HTTP是用来在网络上传输HTML文本的协议,用于浏览器和服务器的通信

### HTTP请求协议分析

请求报文包含: **请求行**, **请求头**, **空行**, **请求体**

**General**

**Response Headers**

**Request Headers**

Cookies 一般以请求头的形式发送

协议项

request URL: www.google.com

request method: GET

status code: 200

remote address: 127.0.0.1: 50470

### HTTP方法

HTTP （与 Web 应用会话的协议）有许多不同的访问 URL 方法。

默认情况下，路由只回应 GET 请求，但是通过 `route()`装饰器传递 methods 参数可以改变这个行为。这里有一些例子:

```python
@app.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        do_the_login()
    else:
        show_the_login_form()
```

如果存在 GET ，那么也会替你自动地添加 HEAD，无需干预。它会确保遵照 `HTTP RFC`（描述 HTTP 协议的文档）处理 HEAD 请求，所以你可以完全忽略这部分的 HTTP 规范。同样，自从 Flask 0.6 起， 也实现了 OPTIONS 的自动处理。

HTTP方法的语义说明:

| [HTTP method](https://en.wikipedia.org/wiki/HTTP_method) | [CRUD](https://en.wikipedia.org/wiki/CRUD) equivalent |                         Description                          |
| :------------------------------------------------------: | :---------------------------------------------------: | :----------------------------------------------------------: |
|                           GET                            |                         Read                          |     Get a representation of the target resource’s state.     |
|                           POST                           |                        Create                         | Let the target resource process the representation enclosed in the request. |
|                           PUT                            |                        Update                         | Set the target resource’s state to the state defined by the representation enclosed in the request. |
|                          DELETE                          |                        Delete                         |             Delete the target resource’s state.              |

| 方法    | 作用                                                         |
| ------- | ------------------------------------------------------------ |
| GET     | 浏览器告知服务器：只 **获取** 页面上的信息并发给我。这是最常用的方法。 |
| HEAD    | 浏览器告诉服务器：欲获取信息，但是只关心 **消息头** 。应用应像处理 GET 请求一样来处理它，但是不分发实际内容。在 Flask 中你完全无需 人工 干预，底层的 Werkzeug 库已经替你打点好了。 |
| POST    | 浏览器告诉服务器：想在 URL 上 **发布** 新信息。并且，服务器必须确保 数据已存储且仅存储一次。这是 HTML 表单通常发送数据到服务器的方法。 |
| PUT     | 类似 POST 但是服务器可能触发了存储过程多次，多次覆盖掉旧值。你可能会问这有什么用，当然这是有原因的。考虑到传输中连接可能会丢失，在这种情况下浏览器和服务器之间的系统可能安全地第二次接收请求，而不破坏其它东西。因为 POST它只触发一次，所以用 POST 是不可能的。 |
| DELETE  | 删除给定位置的信息。                                         |
| OPTIONS | 给客户端提供一个敏捷的途径来弄清这个 URL 支持哪些 HTTP 方法。 从 Flask 0.6 开始，实现了自动处理。 |

### GET



### POST



### GET与POST的区别

[参考文档](https://www.huaweicloud.com/articles/11adf8c5e55a63fec81650988a8eeedb.html)

- GET请求会被浏览器主动cache，而POST不会，除非手动设置。
- 1、GET参数通过URL传递，POST放在Request body中（json格式，需要实例.text/ .content获取内容 ）。
- GET请求参数会被完整保留在浏览器历史记录里，而POST中的参数不会被保留。
- Get 请求中有非 ASCII 字符，会在请求之前进行转码，POST不用，因为POST在Request body中，通过 MIME，也就可以传输非 ASCII 字符。
- 一般我们在浏览器输入一个网址访问网站都是GET请求
- HTTP的底层是TCP/IP。HTTP只是个行为准则，而TCP才是GET和POST怎么实现的基本。GET/POST都是TCP链接。GET和POST能做的事情是一样一样的。但是请求的数据量太大对浏览器和服务器都是很大负担。所以业界有了不成文规定，（大多数）浏览器通常都会限制url长度在2K个字节，而（大多数）服务器最多处理64K大小的url。
- GET产生一个TCP数据包；POST产生两个TCP数据包。对于GET方式的请求，浏览器会把http header和data一并发送出去，服务器响应200（返回数据）；而对于POST，浏览器先发送header，服务器响应100 continue，浏览器再发送data，服务器响应200 ok（返回数据）。
- 在网络环境好的情况下，发一次包的时间和发两次包的时间差别基本可以无视。而在网络环境差的情况下，两次包的TCP在验证数据包完整性上，有非常大的优点。但并不是所有浏览器都会在POST中发送两次包，Firefox就只发送一次。

## 请求与响应

**URL中 `/` 表示路径 ,  `?` 表示请求参数**

请求request

响应response

![Web应用处理流程](https://wwfyde.oss-cn-hangzhou.aliyuncs.com/images/20210426193258.jpg)

## 请求

### 利用HTTP协议向服务器传参的四种方式

- 提取URL的特定部分，在服务器端的路由中用正则表达式截取；
- 查询字符串(query string)，形如key1=value1&key2=value2;
- 请求体(body)中发送的数据，比如表单数据、json、xml；
- 在HTTP报文的(header)中。

在Web应用中，服务器把网页传给浏览器，实际上就是把网页的HTML代码发送给浏览器，让浏览器显示出来。而**浏览器和服务器之间的传输协议**是**HTTP**，所以：

- HTML是一种用来定义网页的文本，会HTML，就可以编写网页；
- **HTTP是在网络上传输HTML的协议，用于浏览器和服务器的通信**。

Chrome浏览器提供了一套完整地调试工具，非常适合Web开发。

开发者工具: Ctrl + Shift + I   | F12    进入帮助

| 功能        | 中文       | 描述                                                         |
| ----------- | ---------- | ------------------------------------------------------------ |
| Elements    | 元素面板   | 操作DOM和CSS来迭代布局和设计页面                             |
| Network     | 网络面板   | 了解请求和下载的资源文件并优化网页加载性能                   |
| Console     | 控制台面板 | 记录诊断信息，或者使用它作为 shell在页面上与JavaScript交互。 |
| Sources     | 源代码面板 | 设置断点来调试 JavaScript ，或者通过Workspaces（工作区）连接本地文件来使用开发者工具的实时编辑器。 |
| Performance | 性能面板   | 使用时间轴面板可以通过记录和查看网站生命周期内发生的各种事件来提高页面的运行时性能。 |
| Memory      | 内存面板   | 内存分析                                                     |
|             | 应用面板   | 加载所有资源                                                 |
| Security    | 安全面板   | 使用安全面板调试混合内容问题，证书问题等等                   |

### HTTP请求方法



| GET  | GET方法请求一个指定资源的表示形式. 使用GET的请求应该只被用于获取数据.(不包含请求体) |
| ---- | ------------------------------------------------------------ |
| HEAD | HEAD方法请求一个与GET请求的响应相同的响应，但没有响应体.     |
| POST | POST方法用于将实体提交到指定的资源，通常导致在服务器上的状态变化或副作用. |
| PUT  | PUT方法用请求有效载荷替换目标资源的所有当前表示。            |

### HTTP协议的分析

# HTTPS-超文本安全传输协议

> [wiki](https://en.wikipedia.org/wiki/HTTPS)
>
> 网络层协议

# TLS/SSL-安全套接字层

# TNS协议





# 分层学习

知识层

原理层

计算层

应用层

## 专题学习

### 基本网络设备

及部件是连接到网络中的物理[实体](https://baike.baidu.com/item/实体/422661)。网络设备的种类繁多，且与日俱增。基本的网络设备有：[计算机](https://baike.baidu.com/item/计算机/140338)（终端设备或服务器）、集线器、交换机、网桥、路由器、中继器、网闸、网关.

、网络接口卡（NIC）、无线接入点（WAP）、调制解调器、光纤收发器。

服务器

中继器 - 物理层 网络扩展

网桥 - 数据链路层

路由器 - 网络层

防火墙 - 硬件防火墙/网闸

交换机 - 网络层

交换机是一种基于MAC地址识别，能完成封装转发**数据包**功能的网络设备。交换机可以“学习”MAC地址，并把其存放在内部地址表中，通过在数据帧的始发者和目标接收者之间建立临时的交换路径，使数据帧直接由源地址到达目的地址。

## 问题引导学习

# *计算机网络原理课后习题*

## 第一章